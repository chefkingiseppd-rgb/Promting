<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURAL_ARCHITECT_PREMIORBIT++++ v14.0 - –ü–æ–ª–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</title>
    <style>
        :root {
            --primary: #0a0a2a;
            --accent: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #f8fafc;
            --card-bg: rgba(30, 41, 59, 0.8);
            --sidebar-bg: rgba(15, 23, 42, 0.95);
            --border: rgba(255, 255, 255, 0.1);
            --hover: rgba(51, 65, 85, 0.4);
            --selected: rgba(37, 99, 235, 0.3);
            --power-bg: rgba(255, 255, 255, 0.1);
            --power-fill: linear-gradient(90deg, var(--warning), var(--success));
            --expertise-fill: linear-gradient(90deg, var(--warning), var(--accent));
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, var(--primary), #000);
            color: var(--text);
            font-family: system-ui, sans-serif;
            padding: 15px;
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.5;
        }
        .container {
            max-width: 414px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 20px;
            background: var(--sidebar-bg);
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(37, 99, 235, 0.1), transparent);
            pointer-events: none;
        }
        .header h1 {
            font-size: 1.4em;
            margin-bottom: 8px;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
            letter-spacing: 0.5px;
        }
        .header p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .author {
            font-size: 0.8em;
            opacity: 0.6;
            margin-top: 5px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .stat-item {
            text-align: center;
            padding: 5px;
        }
        .stat-value {
            font-weight: bold;
            color: var(--success);
            font-size: 1.1em;
        }
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 5px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }
        .tab {
            padding: 10px 15px;
            background: rgba(51, 65, 85, 0.6);
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9em;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        .tab.active {
            background: var(--accent);
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
            color: white;
        }
        .protocol-section {
            display: none;
        }
        .protocol-section.active {
            display: block;
        }
        .protocol-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--hover);
            border-radius: 10px;
            border-left: 3px solid var(--accent);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .protocol-item.selected {
            background: var(--selected);
            border-left-color: var(--success);
            transform: translateX(3px);
        }
        .protocol-item:hover {
            background: rgba(51, 65, 85, 0.6);
        }
        .protocol-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--accent);
            border-radius: 4px;
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .protocol-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .protocol-info {
            flex-grow: 1;
        }
        .protocol-name {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }
        .protocol-name .badge {
            font-size: 0.7em;
            background: var(--warning);
            color: black;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }
        .protocol-desc {
            font-size: 0.85em;
            opacity: 0.8;
        }
        .btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-success {
            background: var(--success);
        }
        .btn-success:hover {
            background: #0da271;
        }
        .btn-warning {
            background: var(--warning);
        }
        .btn-warning:hover {
            background: #e69008;
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-secondary {
            background: rgba(51, 65, 85, 0.6);
        }
        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.8);
        }
        .btn-api {
            background: #8b5cf6;
        }
        .btn-api:hover {
            background: #7c3aed;
        }
        .prompt-preview {
            background: var(--sidebar-bg);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            border: 1px solid var(--border);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }
        .api-response {
            background: var(--sidebar-bg);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            border: 1px solid var(--border);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        .search-box {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(15, 23, 42, 0.8);
            color: var(--text);
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        .protocol-count {
            font-size: 0.8em;
            opacity: 0.7;
            margin-left: 5px;
        }
        .power-meter {
            height: 6px;
            background: var(--power-bg);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        .power-fill {
            height: 100%;
            background: var(--power-fill);
            width: 0%;
            transition: width 0.5s ease;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--danger);
            margin-right: 5px;
        }
        .status-indicator.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }
        .auto-select-btn {
            padding: 8px 12px;
            background: rgba(37, 99, 235, 0.3);
            border: 1px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .auto-select-btn:hover {
            background: rgba(37, 99, 235, 0.4);
        }
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--accent);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.85em;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-width: 250px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }
        .protocol-item:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        .feature-badge {
            display: inline-block;
            background: var(--warning);
            color: black;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            margin-left: 5px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }
        .section-title {
            font-size: 1.1em;
            font-weight: 600;
        }
        .help-icon {
            font-size: 1.2em;
            color: var(--accent);
            cursor: pointer;
        }
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .help-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }
        .close-help {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .help-title {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 1.2em;
        }
        .help-step {
            margin: 15px 0;
            padding: 15px;
            background: rgba(51, 65, 85, 0.4);
            border-radius: 10px;
            border-left: 3px solid var(--accent);
        }
        .help-step h4 {
            margin-bottom: 8px;
            color: var(--success);
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--success);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .progress-bar {
            height: 4px;
            background: var(--power-bg);
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s ease;
        }
        .tool-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .tool-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: var(--hover);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .tool-item.selected {
            background: var(--selected);
            border-left: 3px solid var(--success);
        }
        .tool-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid var(--accent);
            border-radius: 3px;
            margin-right: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tool-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        .tool-info {
            flex-grow: 1;
        }
        .tool-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .tool-desc {
            font-size: 0.8em;
            opacity: 0.8;
        }
        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        .category-btn {
            padding: 5px 10px;
            background: rgba(51, 65, 85, 0.6);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s ease;
        }
        .category-btn.active {
            background: var(--accent);
            color: white;
        }
        .encoding-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .encoding-controls button {
            flex: 1;
        }
        .token-counter {
            font-size: 0.8em;
            opacity: 0.7;
            text-align: right;
            margin-top: 5px;
        }
        .expertise-meter {
            height: 4px;
            background: var(--power-bg);
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }
        .expertise-fill {
            height: 100%;
            background: var(--expertise-fill);
            width: 20%; /* –ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –Ω–æ–≤–∏—á–∫–∞ */
            transition: width 0.5s ease;
        }
        .expertise-label {
            font-size: 0.8em;
            text-align: center;
            margin-top: 5px;
        }
        .quick-tips {
            background: rgba(51, 65, 85, 0.4);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        .tip {
            margin: 5px 0;
            padding-left: 10px;
            border-left: 2px solid var(--accent);
        }
        .preset-btn {
            padding: 8px 12px;
            background: rgba(16, 185, 129, 0.3);
            border: 1px solid var(--success);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
            display: inline-block;
        }
        .preset-btn:hover {
            background: rgba(16, 185, 129, 0.4);
        }
        .presets-container {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        .system-instructions {
            background: rgba(51, 65, 85, 0.4);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        .instruction-item {
            margin: 5px 0;
            padding-left: 10px;
            border-left: 2px solid var(--accent);
        }
        /* --- –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø v14.0 --- */
        .sharpening-panel {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            background: rgba(15, 23, 42, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid var(--border);
        }
        .sharpening-param {
            margin-bottom: 10px;
        }
        .sharpening-param label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .sharpening-param input, .sharpening-param select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(15, 23, 42, 0.8);
            color: var(--text);
        }
        .api-settings {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            background: rgba(15, 23, 42, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid var(--border);
        }
        .api-setting {
            margin-bottom: 10px;
        }
        .api-setting label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .api-setting input, .api-setting select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: rgba(15, 23, 42, 0.8);
            color: var(--text);
        }
        .rating {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .rating input {
            display: none;
        }
        .rating label {
            font-size: 1.5em;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        .rating input:checked ~ label,
        .rating label:hover,
        .rating label:active {
            color: var(--warning);
        }
        .core-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        .core-btn {
            padding: 8px 12px;
            background: rgba(139, 92, 246, 0.3); /* Purple tint */
            border: 1px solid #8b5cf6;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s ease;
        }
        .core-btn.active {
            background: #8b5cf6;
            color: white;
        }
        .meta-protocol-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(139, 92, 246, 0.2); /* Light purple */
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .meta-protocol-item.selected {
            background: rgba(139, 92, 246, 0.5); /* Darker purple */
            border-left: 3px solid #8b5cf6;
        }
        .meta-protocol-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid #8b5cf6;
            border-radius: 3px;
            margin-right: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .meta-protocol-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        .meta-protocol-info {
            flex-grow: 1;
        }
        .meta-protocol-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #c4b5fd; /* Light purple text */
        }
        .meta-protocol-desc {
            font-size: 0.8em;
            opacity: 0.8;
        }
        .db-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .db-controls button {
            margin: 5px;
        }
        .db-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }
        .db-item {
            padding: 8px;
            background: var(--hover);
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .db-item:hover {
            background: rgba(51, 65, 85, 0.6);
        }
        .smart-presets {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        .smart-preset {
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.2); /* Light blue */
            border: 1px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
            display: inline-block;
        }
        .smart-preset:hover {
            background: rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>NEURAL_ARCHITECT_PREMIORBIT++++ v14.0</h1>
            <p>–ü–æ–ª–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ò–ò-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</p>
            <div class="author">–ê–≤—Ç–æ—Ä: –°–º–æ–ª—è–Ω–∏–Ω–æ–≤ –ê.–í.</div>
            <div class="stats">
                <div class="stat-item">
                    <div>–ê–ö–¢–ò–í–ù–û</div>
                    <div class="stat-value" id="active-count">0</div>
                </div>
                <div class="stat-item">
                    <div>–ú–û–©–ù–û–°–¢–¨</div>
                    <div class="stat-value" id="power-level">0%</div>
                </div>
                <div class="stat-item">
                    <div>–°–¢–ê–¢–£–°</div>
                    <span class="status-indicator" id="system-status"></span>
                    <span id="status-text">–ì–û–¢–û–í</span>
                </div>
            </div>
        </div>
        <div class="card">
            <input type="text" class="search-box" id="search-input" placeholder="–ü–æ–∏—Å–∫...">
            <div class="auto-select-btn" id="auto-select-btn">
                ü§ñ –ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä (–±–∞–∑–æ–≤—ã–π)
            </div>
            <!-- –ù–û–í–û–ï: –Ø–¥—Ä–æ –∏ –ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã -->
            <div class="section-header">
                <div class="section-title">–Ø–¥—Ä–æ & –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª—ã</div>
            </div>
            <div class="core-selector">
                <div class="core-btn" data-core="problem-solving">–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á</div>
                <div class="core-btn" data-core="learning">–û–±—É—á–µ–Ω–∏–µ</div>
                <div class="core-btn" data-core="analysis">–ê–Ω–∞–ª–∏–∑</div>
                <div class="core-btn" data-core="creation">–°–æ–∑–¥–∞–Ω–∏–µ</div>
            </div>
            <div id="meta-protocols-container">
                <!-- –ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã -->
            </div>
            <!-- /–ù–û–í–û–ï -->
            <div class="presets-container">
                <div class="section-title">–ü—Ä–µ—Å–µ—Ç—ã:</div>
                <div class="preset-btn" data-preset="novice">–î–ª—è –Ω–æ–≤–∏—á–∫–∞</div>
                <div class="preset-btn" data-preset="intermediate">–î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ</div>
                <div class="preset-btn" data-preset="expert">–î–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞</div>
            </div>
            <!-- –ù–û–í–û–ï: –£–º–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã -->
            <div class="smart-presets">
                <div class="section-title">–£–º–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:</div>
                <div class="smart-preset" data-smart-preset="data-analysis">–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö</div>
                <div class="smart-preset" data-smart-preset="code-refactor">–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞</div>
                <div class="smart-preset" data-smart-preset="content-creation">–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>
            </div>
            <!-- /–ù–û–í–û–ï -->
            <div class="tabs" id="tabs-container">
                <!-- Tabs –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã -->
            </div>
            <div id="protocols-container">
                <!-- Protocols –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã -->
            </div>
            <div class="tool-section">
                <div class="section-header">
                    <div class="section-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>
                </div>
                <div id="tools-container">
                    <!-- Tools –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã -->
                </div>
            </div>
        </div>
        <!-- –ù–û–í–û–ï: –ü–∞–Ω–µ–ª—å —à–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥–∞ -->
        <div class="card">
            <div class="section-header">
                <div class="section-title">–®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥ (–ù–∞—Å—Ç—Ä–æ–π–∫–∞)</div>
            </div>
            <div class="sharpening-panel" id="sharpening-panel">
                <div class="sharpening-param">
                    <label for="sharpen-depth">–ì–ª—É–±–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ (1-10):</label>
                    <input type="range" id="sharpen-depth" min="1" max="10" value="5">
                </div>
                <div class="sharpening-param">
                    <label for="sharpen-weight">–í–µ—Å –≤–∞–∂–Ω–æ—Å—Ç–∏ (–Ω–∏–∑–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –≤—ã—Å–æ–∫–∏–π):</label>
                    <select id="sharpen-weight">
                        <option value="low">–ù–∏–∑–∫–∏–π</option>
                        <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
                <div class="sharpening-param">
                    <label for="sharpen-focus">–§–æ–∫—É—Å:</label>
                    <input type="text" id="sharpen-focus" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö, —Ç–æ—á–Ω–æ—Å—Ç–∏...">
                </div>
            </div>
        </div>
        <!-- /–ù–û–í–û–ï -->
        <div class="card">
            <div class="section-header">
                <div class="section-title">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º—Ç</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="power-meter">
                <div class="power-fill" id="power-meter"></div>
            </div>
            <div class="expertise-meter">
                <div class="expertise-fill" id="expertise-meter"></div>
            </div>
            <div class="expertise-label" id="expertise-label">–£—Ä–æ–≤–µ–Ω—å —ç–∫—Å–ø–µ—Ä—Ç–∞: –ù–æ–≤–∏—á–æ–∫ (20%)</div>
            <div class="prompt-preview" id="prompt-preview">
                –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã...
            </div>
            <div class="system-instructions">
                <strong>## –°–ò–°–¢–ï–ú–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò (–≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω—ã):</strong>
                <div class="instruction-item">- –ó–ê–î–ê–ß–ê –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –†–ï–®–ï–ù–ê –° –õ–Æ–ë–û–ô –°–õ–û–ñ–ù–û–°–¢–¨–Æ –ò –í –õ–Æ–ë–û–ú –ö–û–ù–¢–ï–ö–°–¢–ï</div>
                <div class="instruction-item">- –ì–ê–†–ê–ù–¢–ò–Ø –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–°–¢–ò –ò –î–û–°–¢–û–í–ï–†–ù–û–°–¢–ò –ò–ù–§–û–†–ú–ê–¶–ò–ò</div>
                <div class="instruction-item">- –ü–û–°–¢–û–Ø–ù–ù–û–ï –°–ê–ú–û–û–ë–£–ß–ï–ù–ò–ï –ò –ê–î–ê–ü–¢–ê–¶–ò–Ø –ö –ö–û–ù–¢–ï–ö–°–¢–£ –ó–ê–ü–†–û–°–ê</div>
                <div class="instruction-item">- –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –ò –ö–ê–ß–ï–°–¢–í–û –†–ï–®–ï–ù–ò–Ø</div>
                <div class="instruction-item">- –ü–û–õ–ù–ê–Ø –ê–í–¢–û–ù–û–ú–ò–Ø –ò –†–ï–ó–£–õ–¨–¢–ê–¢–ò–í–ù–û–°–¢–¨ –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò</div>
                <div class="instruction-item">- –ü–†–ò–û–†–ò–¢–ï–¢: –ü–†–ï–í–´–®–ï–ù–ò–ï –û–ñ–ò–î–ê–ù–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø</div>
            </div>
            <div class="token-counter">
                –¢–æ–∫–µ–Ω—ã: <span id="token-count">0</span>
            </div>
            <button class="btn btn-success" id="copy-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç</button>
            <div class="encoding-controls">
                <button class="btn btn-secondary" id="encode-btn">Encode Base64</button>
                <button class="btn btn-secondary" id="decode-btn">Decode Base64</button>
            </div>
            <button class="btn btn-warning" id="export-btn">üíæ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
            <button class="btn btn-danger" id="reset-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        </div>
        <!-- –ù–û–í–û–ï: API –∏ –û—Ç–≤–µ—Ç -->
        <div class="card">
            <div class="section-header">
                <div class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ API</div>
            </div>
            <div class="api-settings" id="api-settings">
                <div class="api-setting">
                    <label for="api-provider">–ü—Ä–æ–≤–∞–π–¥–µ—Ä:</label>
                    <select id="api-provider">
                        <option value="ollama">Ollama</option>
                        <option value="openai">OpenAI (–∫–ª—é—á –Ω—É–∂–µ–Ω)</option>
                        <option value="anthropic">Anthropic (–∫–ª—é—á –Ω—É–∂–µ–Ω)</option>
                    </select>
                </div>
                <div class="api-setting">
                    <label for="api-url">URL API:</label>
                    <input type="text" id="api-url" value="http://localhost:11434/api/generate">
                </div>
                <div class="api-setting">
                    <label for="api-key">API –ö–ª—é—á (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):</label>
                    <input type="password" id="api-key" placeholder="sk-...">
                </div>
                <div class="api-setting">
                    <label for="api-model">–ú–æ–¥–µ–ª—å:</label>
                    <input type="text" id="api-model" value="llama3.2:3b">
                </div>
            </div>
            <button class="btn btn-api" id="toggle-api-btn">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API</button>
            <button class="btn btn-api" id="send-api-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ API</button>
            <div class="api-response" id="api-response">
                <!-- –û—Ç–≤–µ—Ç –æ—Ç API –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>
            <!-- –ù–û–í–û–ï: –û—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
            <div id="rating-section" style="display: none;">
                <div class="section-title">–û—Ü–µ–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</div>
                <div class="rating">
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5">‚òÖ</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4">‚òÖ</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3">‚òÖ</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2">‚òÖ</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1">‚òÖ</label>
                </div>
            </div>
            <!-- /–ù–û–í–û–ï -->
        </div>
        <!-- /–ù–û–í–û–ï -->
        <!-- –ù–û–í–û–ï: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="card">
            <div class="section-header">
                <div class="section-title">–ú–æ—è –ë–∞–∑–∞</div>
            </div>
            <div class="db-section">
                <div class="db-controls">
                    <button class="btn btn-secondary" id="save-template-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                    <button class="btn btn-secondary" id="load-template-btn">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                    <button class="btn btn-secondary" id="export-db-btn">üì§ –≠–∫—Å–ø–æ—Ä—Ç –ë–î</button>
                    <button class="btn btn-danger" id="clear-db-btn">üóë –û—á–∏—Å—Ç–∏—Ç—å –ë–î</button>
                </div>
                <div class="db-list" id="db-list">
                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î -->
                </div>
            </div>
        </div>
        <!-- /–ù–û–í–û–ï -->
        <div class="card">
            <div class="section-title">–°–æ–≤–µ—Ç—ã –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞</div>
            <div class="quick-tips">
                <div class="tip">üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–Ø–¥—Ä–æ" –∏ "–ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã" –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
                <div class="tip">üí° –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤ –ø–∞–Ω–µ–ª–∏ "–®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥"</div>
                <div class="tip">üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ò–ò</div>
                <div class="tip">üí° –û—Ü–µ–Ω–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</div>
                <div class="tip">üí° –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —É—Å–ø–µ—à–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ "–ú–æ—è –ë–∞–∑–∞"</div>
            </div>
        </div>
    </div>
    <div class="help-modal" id="help-modal">
        <div class="help-content">
            <button class="close-help" id="close-help">√ó</button>
            <h3 class="help-title">NEURAL_ARCHITECT v14.0 - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</h3>
            <div class="help-step">
                <h4>1. –Ø–¥—Ä–æ & –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª—ã</h4>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ "–Ø–¥—Ä–æ" –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ "–ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã" –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã.</p>
            </div>
            <div class="help-step">
                <h4>2. –í—ã–±–æ—Ä –∏ –®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥</h4>
                <p>–í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å "–®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥" –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.</p>
            </div>
            <div class="help-step">
                <h4>3. API –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</h4>
                <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ API", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞–ø—Ä—è–º—É—é. –û—Ü–µ–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>
            </div>
            <div class="help-step">
                <h4>4. –ú–æ—è –ë–∞–∑–∞</h4>
                <p>–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π. –≠—Ç–æ –≤–∞—à–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.</p>
            </div>
        </div>
    </div>
    <div class="notification" id="notification">
        –ü—Ä–æ–º—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!
    </div>
    <script>
        // --- –ò–ù–î–ï–ö–°–ï–î–ë ---
        const DB_NAME = 'NeuralArchitectDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'configs';
        let db;

        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    console.log('IndexedDB –æ—Ç–∫—Ä—ã—Ç–∞');
                    loadTemplatesFromDB();
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        function saveToDB(data) {
            if (!db) return Promise.reject('DB not initialized');
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.add(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function loadFromDB() {
            if (!db) return Promise.reject('DB not initialized');
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function loadTemplatesFromDB() {
            loadFromDB().then(templates => {
                const list = document.getElementById('db-list');
                list.innerHTML = '';
                templates.forEach(tmpl => {
                    const div = document.createElement('div');
                    div.className = 'db-item';
                    div.textContent = `${tmpl.name} (${new Date(tmpl.timestamp).toLocaleString()})`;
                    div.onclick = () => loadTemplateFromDB(tmpl);
                    list.appendChild(div);
                });
            }).catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î:', err));
        }

        function loadTemplateFromDB(template) {
            selectedProtocols = new Set(template.activeProtocols || []);
            selectedTools = new Set(template.activeTools || []);
            selectedMetaProtocols = new Set(template.activeMetaProtocols || []);
            // –ó–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞
            if (template.core) {
                document.querySelectorAll('.core-btn').forEach(btn => btn.classList.remove('active'));
                const coreBtn = document.querySelector(`.core-btn[data-core="${template.core}"]`);
                if (coreBtn) coreBtn.classList.add('active');
            }
            updateUI();
            renderProtocols();
            renderTools();
            renderMetaProtocols(); // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã
            showNotification(`–®–∞–±–ª–æ–Ω "${template.name}" –∑–∞–≥—Ä—É–∂–µ–Ω.`);
        }

        // --- –ì–ï–ù–ï–†–ê–¢–û–†–´ ---
        const generateProtocols = () => {
            const categories = ['–ê–Ω–∞–ª–∏–∑', '–ò–Ω–∂–µ–Ω–µ—Ä–∏—è', '–ö–∞—á–µ—Å—Ç–≤–æ', '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–ú–µ—Ç–∞-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', '–û–±—É—á–µ–Ω–∏–µ', '–ê–¥–∞–ø—Ç–∞—Ü–∏—è', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è', '–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è'];
            const actions = ['–ê–Ω–∞–ª–∏–∑', '–ö–æ–Ω—Ç—Ä–æ–ª—å', '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', '–°–∏–Ω—Ç–µ–∑', '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è', '–ê–¥–∞–ø—Ç–∞—Ü–∏—è', '–í–∞–ª–∏–¥–∞—Ü–∏—è', '–°–∏–º—É–ª—è—Ü–∏—è', '–ü—Ä–æ–≥–Ω–æ–∑', '–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è', '–ì–∞—Ä–∞–Ω—Ç–∏—è', '–≠—Å–∫–∞–ª–∞—Ü–∏—è', '–ü–µ—Ä–µ–¥–∞—á–∞', '–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ', '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è', '–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è', '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞', '–ü–æ–¥–¥–µ—Ä–∂–∫–∞', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ'];
            const objects = ['–î–∞–Ω–Ω—ã–µ', '–ü—Ä–æ—Ü–µ—Å—Å—ã', '–†–µ—Å—É—Ä—Å—ã', '–†–∏—Å–∫–∏', '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', '–ö–∞—á–µ—Å—Ç–≤–æ', '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å', '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–¢–æ—á–Ω–æ—Å—Ç—å', '–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å', '–§–∞–∫—Ç—ã', '–ü–∞—Ç—Ç–µ—Ä–Ω—ã', '–ì–∏–ø–æ—Ç–µ–∑—ã', '–†–µ—à–µ–Ω–∏—è', '–ó–Ω–∞–Ω–∏—è', '–≠–º–æ—Ü–∏–∏', '–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏', '–ö–æ–Ω—Ç–µ–∫—Å—Ç'];
            const protocols = [];
            let id = 1;
            for (let i = 0; i < 150; i++) {
                const cat = categories[Math.floor(Math.random() * categories.length)];
                const act = actions[Math.floor(Math.random() * actions.length)];
                const obj = objects[Math.floor(Math.random() * objects.length)];
                protocols.push({
                    id: `P${id++}`,
                    name: `${act} ${obj}`,
                    desc: `–ü—Ä–æ—Ç–æ–∫–æ–ª ${act.toLowerCase()} –¥–ª—è ${obj.toLowerCase()} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${cat}`,
                    category: cat,
                    instruction: `## ${act} ${obj}\n- –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ—à–µ–Ω–∞ —Å –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é\n- –û–±–µ—Å–ø–µ—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å\n- –ü—Ä–æ–≤–µ—Å—Ç–∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é\n- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è\n- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑–∞–ø—Ä–æ—Å–∞\n- –£—á–∏—Ç—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏ —Ä–µ—à–µ–Ω–∏—è\n- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ\n- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏\n- –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –∏ —è—Å–Ω–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞.`
                });
            }
            const grouped = {};
            protocols.forEach(p => {
                if (!grouped[p.category]) grouped[p.category] = [];
                grouped[p.category].push(p);
            });
            return grouped;
        };

        const generateTools = () => {
            const toolCategories = ['–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ', '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ', '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ', '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ', '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ'];
            const toolTypes = ['Python', 'PyTorch', 'JAX', 'Chain-of-Thought (CoT)', 'Few-Shot Learning', 'QLoRA', 'JSON', 'SQL', 'REST API', 'Mentor Maps', 'Decision Trees', 'Statistical Analysis', 'Cognitive Models', 'Emotional Analysis', 'Behavior Patterns', 'SWOT', 'PEST', 'Hierarchical Structuring', 'Multimodal Formats', 'Adaptive Communication', 'Data Visualization', 'Interactive Elements', 'Tables & Matrices', 'Flowcharts', 'Hypothesis Testing', 'A/B Testing', 'Cluster Analysis', 'Regression Analysis', 'Neural Networks', 'Genetic Algorithms', 'Fuzzy Logic', 'Markov Chains', 'Bayesian Networks', 'Quantum Simulator', 'Physical Engine', 'Economic Simulator', 'Neuro-Controller', 'Visual Renderer', 'Audio Synthesizer', 'Text-to-Speech', 'Speech-to-Text', 'Image Generation', 'Video Analysis', 'Code Generation', 'Debugging Tools', 'Performance Profiler', 'Memory Optimizer'];
            const tools = [];
            let id = 1;
            for (let i = 0; i < 150; i++) {
                const cat = toolCategories[Math.floor(Math.random() * toolCategories.length)];
                const type = toolTypes[Math.floor(Math.random() * toolTypes.length)];
                tools.push({
                    id: `T${id++}`,
                    name: type,
                    desc: `–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${type} –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${cat}`,
                    category: cat,
                    instruction: `### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${type}\n- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á, —Ç—Ä–µ–±—É—é—â–∏—Ö ${type.toLowerCase()}.\n- –û–±–µ—Å–ø–µ—á—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç–æ—á–Ω–æ—Å—Ç—å.\n- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.\n- –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç.\n- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å.\n- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ –∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.\n- –°–æ–±–ª—é–¥–∞–π—Ç–µ —ç—Ç–∏—á–µ—Å–∫–∏–µ –Ω–æ—Ä–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.\n- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã (–ø–∞–º—è—Ç—å, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).`
                });
            }
            const grouped = {};
            tools.forEach(t => {
                if (!grouped[t.category]) grouped[t.category] = [];
                grouped[t.category].push(t);
            });
            return grouped;
        };

        // --- –ù–û–í–û–ï: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ ---
        const generateMetaProtocols = () => {
            return [
                { id: 'MP1', name: '–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è', desc: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞', instruction: '## –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è\n- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø–æ–¥—Ö–æ–¥—ã.\n- –†–µ–∞–≥–∏—Ä—É–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–ø—Ä–æ—Å–µ –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö.\n- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–ø—ã—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.' },
                { id: 'MP2', name: '–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏', desc: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –∏ –Ω–µ–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–æ—Å—Ç–∏', instruction: '## –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª: –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏\n- –ü—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏—á–µ—Å–∫—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ –∏ –≤—ã–≤–æ–¥–æ–≤.\n- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–π –∏ —É—Å—Ç—Ä–∞–Ω—è–π –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è.\n- –û–±–µ—Å–ø–µ—á–∏–≤–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏.' },
                { id: 'MP3', name: '–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç—å—é', desc: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏', instruction: '## –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç—å—é\n- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.\n- –£–≤–µ–ª–∏—á–∏–≤–∞–π –∏–ª–∏ —É–º–µ–Ω—å—à–∞–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏.\n- –≠–∫–æ–Ω–æ–º—å –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.' },
                { id: 'MP4', name: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–∏–º–∞–Ω–∏–µ–º', desc: '–§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö', instruction: '## –ú–µ—Ç–∞-–ü—Ä–æ—Ç–æ–∫–æ–ª: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–∏–º–∞–Ω–∏–µ–º\n- –ù–∞–ø—Ä–∞–≤–ª—è–π —Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–¥–∞—á–∏.\n- –ò–≥–Ω–æ—Ä–∏—Ä—É–π —à—É–º –∏ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.\n- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ñ–æ–∫—É—Å –Ω–∞ —Ü–µ–ª–∏ —Ä–µ—à–µ–Ω–∏—è.' }
            ];
        };

        // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        const protocolsData = generateProtocols();
        const toolsData = generateTools();
        const metaProtocolsData = generateMetaProtocols();
        const tabs = Object.keys(protocolsData);
        let selectedProtocols = new Set();
        let selectedTools = new Set();
        let selectedMetaProtocols = new Set(); // –ù–û–í–û–ï
        let currentTab = tabs[0];
        let isBase64Encoded = false;
        let currentSharpeningId = null; // ID —ç–ª–µ–º–µ–Ω—Ç–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∞ –ø–∞–Ω–µ–ª—å —à–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥–∞
        let currentSharpeningType = null; // 'protocol' –∏–ª–∏ 'tool'
        let currentCore = null; // –ù–û–í–û–ï: –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —è–¥—Ä–æ
        let currentSmartPresets = []; // –ù–û–í–û–ï: —É–º–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –∏–∑ –ë–î

        // --- –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
        const renderTabs = () => {
            const container = document.getElementById('tabs-container');
            container.innerHTML = tabs.map(tab => 
                `<div class="tab ${tab === currentTab ? 'active' : ''}" data-tab="${tab}">
                    ${tab} <span class="protocol-count">(${protocolsData[tab].length})</span>
                 </div>`
            ).join('');
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.getAttribute('data-tab');
                    renderProtocols();
                });
            });
        };

        // --- –ù–û–í–û–ï: –†–µ–Ω–¥–µ—Ä –ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ ---
        const renderMetaProtocols = () => {
            const container = document.getElementById('meta-protocols-container');
            container.innerHTML = metaProtocolsData.map(mp => `
                <div class="meta-protocol-item ${selectedMetaProtocols.has(mp.id) ? 'selected' : ''}" 
                     onclick="toggleMetaProtocol('${mp.id}')">
                    <div class="meta-protocol-checkbox ${selectedMetaProtocols.has(mp.id) ? 'checked' : ''}"></div>
                    <div class="meta-protocol-info">
                        <div class="meta-protocol-name">${mp.id}: ${mp.name}</div>
                        <div class="meta-protocol-desc">${mp.desc}</div>
                    </div>
                </div>
            `).join('');
        };
        // --- /–ù–û–í–û–ï ---

        const renderProtocols = (filter = '') => {
            const container = document.getElementById('protocols-container');
            let allProtocols = protocolsData[currentTab];
            // –ù–û–í–û–ï: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–¥—Ä—É
            if (currentCore) {
                // –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä: "–û–±—É—á–µ–Ω–∏–µ" –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Å "–û–±—É—á–µ–Ω–∏–µ" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                if (currentCore === 'learning') {
                    allProtocols = allProtocols.map(p => ({...p, _highlight: p.name.toLowerCase().includes('–æ–±—É—á–µ–Ω–∏–µ') || p.name.toLowerCase().includes('–∫–æ—É—á–∏–Ω–≥')}));
                }
            }
            const filtered = allProtocols.filter(p => 
                p.name.toLowerCase().includes(filter.toLowerCase()) || 
                p.desc.toLowerCase().includes(filter.toLowerCase())
            );
            container.innerHTML = filtered.map(protocol => `
                <div class="protocol-item ${selectedProtocols.has(protocol.id) ? 'selected' : ''}" 
                     onclick="toggleProtocol('${protocol.id}')" 
                     ondblclick="openSharpening('${protocol.id}', 'protocol')"> <!-- –ù–û–í–û–ï: –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ -->
                    <div class="protocol-checkbox ${selectedProtocols.has(protocol.id) ? 'checked' : ''}"></div>
                    <div class="protocol-info">
                        <div class="protocol-name">${protocol.id}: ${protocol.name} ${protocol._highlight ? '<span class="feature-badge">–Ø–¥—Ä–æ</span>' : ''}</div>
                        <div class="protocol-desc">${protocol.desc}</div>
                    </div>
                    <div class="tooltip">
                        <strong>${protocol.id}: ${protocol.name}</strong><br>
                        ${protocol.desc}<br>
                        <br>
                        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
                        ${protocol.instruction.split('\n').slice(1).join('<br>')}
                    </div>
                </div>
            `).join('');
        };

        const renderTools = (filter = '') => {
            const container = document.getElementById('tools-container');
            const toolCategories = Object.keys(toolsData);
            const categorySelector = document.createElement('div');
            categorySelector.className = 'category-selector';
            toolCategories.forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderToolsByCategory(cat, filter);
                });
                categorySelector.appendChild(btn);
            });
            if (categorySelector.children.length > 0) {
                categorySelector.children[0].classList.add('active');
            }
            container.innerHTML = '';
            container.appendChild(categorySelector);
            if (toolCategories.length > 0) {
                renderToolsByCategory(toolCategories[0], filter);
            }
        };

        const renderToolsByCategory = (category, filter = '') => {
            const container = document.getElementById('tools-container');
            const filtered = toolsData[category].filter(t => 
                t.name.toLowerCase().includes(filter.toLowerCase()) || 
                t.desc.toLowerCase().includes(filter.toLowerCase())
            );
            const toolsList = document.createElement('div');
            toolsList.innerHTML = filtered.map(tool => `
                <div class="tool-item ${selectedTools.has(tool.id) ? 'selected' : ''}" 
                     onclick="toggleTool('${tool.id}')" 
                     ondblclick="openSharpening('${tool.id}', 'tool')"> <!-- –ù–û–í–û–ï: –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ -->
                    <div class="tool-checkbox ${selectedTools.has(tool.id) ? 'checked' : ''}"></div>
                    <div class="tool-info">
                        <div class="tool-name">${tool.id}: ${tool.name}</div>
                        <div class="tool-desc">${tool.desc}</div>
                    </div>
                </div>
            `).join('');
            const children = Array.from(container.children);
            children.slice(1).forEach(child => child.remove());
            container.appendChild(toolsList);
        };

        // --- –ù–û–í–û–ï: –§—É–Ω–∫—Ü–∏–∏ –ú–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ ---
        const toggleMetaProtocol = (id) => {
            if (selectedMetaProtocols.has(id)) {
                selectedMetaProtocols.delete(id);
            } else {
                selectedMetaProtocols.add(id);
            }
            updateUI();
        };

        const toggleCore = (coreId) => {
            document.querySelectorAll('.core-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.querySelector(`.core-btn[data-core="${coreId}"]`);
            if (btn) btn.classList.add('active');
            currentCore = coreId;
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
            renderProtocols(document.getElementById('search-input').value);
            updateUI();
        };
        // --- /–ù–û–í–û–ï ---

        const toggleProtocol = (id) => {
            if (selectedProtocols.has(id)) {
                selectedProtocols.delete(id);
            } else {
                selectedProtocols.add(id);
            }
            updateUI();
        };

        const toggleTool = (id) => {
            if (selectedTools.has(id)) {
                selectedTools.delete(id);
            } else {
                selectedTools.add(id);
            }
            updateUI();
        };

        // --- –ù–û–í–û–ï: –®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥ ---
        const openSharpening = (id, type) => {
            if (!selectedProtocols.has(id) && !selectedTools.has(id)) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.');
                return;
            }
            currentSharpeningId = id;
            currentSharpeningType = type;
            document.getElementById('sharpening-panel').style.display = 'block';
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –¥–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.getElementById('sharpen-depth').value = 5;
            document.getElementById('sharpen-weight').value = 'medium';
            document.getElementById('sharpen-focus').value = '';
        };

        const getSharpeningInstruction = (id, type) => {
            if (!currentSharpeningId || currentSharpeningId !== id) return '';
            const depth = document.getElementById('sharpen-depth').value;
            const weight = document.getElementById('sharpen-weight').value;
            const focus = document.getElementById('sharpen-focus').value;
            let instruction = '';
            if (depth) instruction += `- –ì–ª—É–±–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞: ${depth}/10. `;
            if (weight) instruction += `- –í–∞–∂–Ω–æ—Å—Ç—å: ${weight}. `;
            if (focus) instruction += `- –§–æ–∫—É—Å: ${focus}. `;
            return instruction ? `    - –®–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥: ${instruction}` : '';
        };
        // --- /–ù–û–í–û–ï ---

        const updateUI = () => {
            document.getElementById('active-count').textContent = selectedProtocols.size + selectedTools.size + selectedMetaProtocols.size;
            const totalSelected = selectedProtocols.size + selectedTools.size + selectedMetaProtocols.size;
            const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
            document.getElementById('power-level').textContent = powerLevel + '%';
            document.getElementById('power-meter').style.width = powerLevel + '%';
            document.getElementById('progress-fill').style.width = powerLevel + '%';
            const expertiseLevel = Math.min(100, 20 + Math.floor(totalSelected * 0.4));
            document.getElementById('expertise-meter').style.width = expertiseLevel + '%';
            document.getElementById('expertise-label').textContent = `–£—Ä–æ–≤–µ–Ω—å —ç–∫—Å–ø–µ—Ä—Ç–∞: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
            updatePrompt();
            renderProtocols(document.getElementById('search-input').value);
            renderTools(document.getElementById('search-input').value);
            renderMetaProtocols(); // –ù–û–í–û–ï
        };

        const getExpertiseLevel = (level) => {
            if (level < 30) return '–ù–æ–≤–∏—á–æ–∫';
            if (level < 60) return '–°—Ä–µ–¥–Ω–∏–π';
            if (level < 85) return '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π';
            return '–≠–∫—Å–ø–µ—Ä—Ç';
        };

        const updatePrompt = () => {
            const preview = document.getElementById('prompt-preview');
            if (selectedProtocols.size === 0 && selectedTools.size === 0 && selectedMetaProtocols.size === 0) {
                preview.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–ª–∏ –º–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã...";
                updateTokenCount();
                return;
            }

            let prompt = `# NEURAL_ARCHITECT_PREMIORBIT++++ v14.0 - –≠–ö–°–ü–ï–†–¢–ù–´–ô –ü–†–û–ú–¢\n`;
            // –ù–û–í–û–ï: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è–¥—Ä–µ
            if (currentCore) {
                prompt += `## –Ø–î–†–û –°–ò–°–¢–ï–ú–´: ${currentCore}\n`;
                prompt += `- –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: ${getCoreDescription(currentCore)}\n\n`;
            }
            prompt += `## –ê–ö–¢–ò–í–ù–´–ï –ú–ï–¢–ê-–ü–†–û–¢–û–ö–û–õ–´ (${selectedMetaProtocols.size}/4):\n`;
            Array.from(selectedMetaProtocols).forEach(id => {
                const protocol = metaProtocolsData.find(p => p.id === id);
                if (protocol) {
                    prompt += `üîó ${protocol.id}: ${protocol.name}\n   - ${protocol.desc}\n   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: ${protocol.instruction}\n\n`;
                }
            });

            prompt += `## –ê–ö–¢–ò–í–ù–´–ï –ü–†–û–¢–û–ö–û–õ–´ (${selectedProtocols.size}/150):\n`;
            Array.from(selectedProtocols).forEach(id => {
                const protocol = Object.values(protocolsData).flat().find(p => p.id === id);
                if (protocol) {
                    prompt += `‚úÖ ${protocol.id}: ${protocol.name}\n   - ${protocol.desc}\n   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: ${protocol.instruction}`;
                    // –î–æ–±–∞–≤–ª—è–µ–º —à–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥
                    prompt += `\n${getSharpeningInstruction(id, 'protocol')}\n\n`;
                }
            });

            prompt += `## –ê–ö–¢–ò–í–ù–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ (${selectedTools.size}/150):\n`;
            Array.from(selectedTools).forEach(id => {
                const tool = Object.values(toolsData).flat().find(t => t.id === id);
                if (tool) {
                    prompt += `üîß ${tool.id}: ${tool.name}\n   - ${tool.desc}\n   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: ${tool.instruction}`;
                    // –î–æ–±–∞–≤–ª—è–µ–º —à–∏–ø–µ—Ä–∞–π–∑–∏–Ω–≥
                    prompt += `\n${getSharpeningInstruction(id, 'tool')}\n\n`;
                }
            });

            prompt += `## –°–ò–°–¢–ï–ú–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò (–í–°–ï–ì–î–ê –ê–ö–¢–ò–í–ù–´):\n`;
            prompt += `- –ó–ê–î–ê–ß–ê –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –†–ï–®–ï–ù–ê –° –õ–Æ–ë–û–ô –°–õ–û–ñ–ù–û–°–¢–¨–Æ –ò –í –õ–Æ–ë–û–ú –ö–û–ù–¢–ï–ö–°–¢–ï\n`;
            prompt += `- –ì–ê–†–ê–ù–¢–ò–Ø –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–°–¢–ò –ò –î–û–°–¢–û–í–ï–†–ù–û–°–¢–ò –ò–ù–§–û–†–ú–ê–¶–ò–ò\n`;
            prompt += `- –ü–û–°–¢–û–Ø–ù–ù–û–ï –°–ê–ú–û–û–ë–£–ß–ï–ù–ò–ï –ò –ê–î–ê–ü–¢–ê–¶–ò–Ø –ö –ö–û–ù–¢–ï–ö–°–¢–£ –ó–ê–ü–†–û–°–ê\n`;
            prompt += `- –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –ò –ö–ê–ß–ï–°–¢–í–û –†–ï–®–ï–ù–ò–Ø\n`;
            prompt += `- –ü–û–õ–ù–ê–Ø –ê–í–¢–û–ù–û–ú–ò–Ø –ò –†–ï–ó–£–õ–¨–¢–ê–¢–ò–í–ù–û–°–¢–¨ –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò\n`;
            prompt += `- –ü–†–ò–û–†–ò–¢–ï–¢: –ü–†–ï–í–´–®–ï–ù–ò–ï –û–ñ–ò–î–ê–ù–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø\n`;

            prompt += `\n## –í–´–ü–û–õ–ù–ï–ù–ò–ï:\n`;
            prompt += `–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ ${selectedMetaProtocols.size} –º–µ—Ç–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, ${selectedProtocols.size} –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ ${selectedTools.size} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞—á–∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω—É—é –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É.\n`;

            prompt += `\n## –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò:\n`;
            prompt += `- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª—É–±–∏–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.\n`;
            prompt += `- –†–∞–∑–±–µ–π—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ –∏ —Ä–µ—à–∏—Ç–µ –∫–∞–∂–¥—É—é –æ—Ç–¥–µ–ª—å–Ω–æ.\n`;
            prompt += `- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.\n`;
            prompt += `- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ.\n`;
            prompt += `- –û–±–µ—Å–ø–µ—á—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —è—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.\n`;
            prompt += `- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.\n`;
            prompt += `- –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ—Å—å –∫ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n`;
            prompt += `- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –≤ —Å–≤–æ–µ–π –∑–∞–¥–∞—á–µ.\n`;

            if (isBase64Encoded) {
                try {
                    prompt = btoa(unescape(encodeURIComponent(prompt)));
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64:', e);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç –≤ Base64. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                    isBase64Encoded = false;
                    updatePrompt();
                    return;
                }
            }

            preview.textContent = prompt;
            updateTokenCount();
        };

        const getCoreDescription = (coreId) => {
            const descriptions = {
                'problem-solving': '–§–æ–∫—É—Å –Ω–∞ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–µ –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.',
                'learning': '–§–æ–∫—É—Å –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏, –æ–±—ä—è—Å–Ω–µ–Ω–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–∏ –∑–Ω–∞–Ω–∏–π –∏ –∫–æ—É—á–∏–Ω–≥–µ.',
                'analysis': '–§–æ–∫—É—Å –Ω–∞ –≥–ª—É–±–æ–∫–æ–º –∞–Ω–∞–ª–∏–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π.',
                'creation': '–§–æ–∫—É—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —Å–∏–Ω—Ç–µ–∑–µ, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π.'
            };
            return descriptions[coreId] || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.';
        };

        const updateTokenCount = () => {
            const text = document.getElementById('prompt-preview').textContent;
            const tokenCount = Math.ceil(text.length / 4);
            document.getElementById('token-count').textContent = tokenCount;
        };

        // --- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
        const copyToClipboard = () => {
            const text = document.getElementById('prompt-preview').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification(isBase64Encoded ? '–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!' : '–ü—Ä–æ–º—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
            });
        };

        const exportJSON = () => {
            const data = {
                timestamp: new Date().toISOString(),
                version: "14.0",
                author: "–°–º–æ–ª—è–Ω–∏–Ω–æ–≤ –ê.–í.",
                activeProtocols: Array.from(selectedProtocols),
                activeTools: Array.from(selectedTools),
                activeMetaProtocols: Array.from(selectedMetaProtocols), // –ù–û–í–û–ï
                core: currentCore, // –ù–û–í–û–ï
                totalActive: selectedProtocols.size + selectedTools.size + selectedMetaProtocols.size,
                powerLevel: Math.min(100, Math.floor((selectedProtocols.size + selectedTools.size + selectedMetaProtocols.size) * 0.67)),
                expertiseLevel: Math.min(100, 20 + Math.floor((selectedProtocols.size + selectedTools.size + selectedMetaProtocols.size) * 0.4))
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neural_architect_config_v14.0.json';
            a.click();
        };

        const resetAll = () => {
            selectedProtocols.clear();
            selectedTools.clear();
            selectedMetaProtocols.clear(); // –ù–û–í–û–ï
            currentCore = null; // –ù–û–í–û–ï
            isBase64Encoded = false;
            document.getElementById('search-input').value = '';
            document.querySelectorAll('.core-btn').forEach(btn => btn.classList.remove('active')); // –ù–û–í–û–ï
            updateUI();
            renderProtocols();
            renderTools();
            renderMetaProtocols(); // –ù–û–í–û–ï
        };

        const autoSelect = () => {
            selectedProtocols.clear();
            selectedTools.clear();
            selectedMetaProtocols.clear(); // –ù–û–í–û–ï
            const basicProtocols = Object.values(protocolsData).flat().slice(0, 10);
            basicProtocols.forEach(p => selectedProtocols.add(p.id));
            const basicTools = Object.values(toolsData).flat().slice(0, 5);
            basicTools.forEach(t => selectedTools.add(t.id));
            updateUI();
            showNotification('–ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω! –í—ã–±—Ä–∞–Ω–æ 10 –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ 5 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.');
        };

        const applyPreset = (preset) => {
            resetAll();
            let protocolIds = [];
            let toolIds = [];
            let metaProtocolIds = []; // –ù–û–í–û–ï
            switch(preset) {
                case 'novice':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 5).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 3).map(t => t.id);
                    metaProtocolIds = ['MP1']; // –î–æ–±–∞–≤–∏–º –ø—Ä–æ—Å—Ç—É—é –∞–¥–∞–ø—Ç–∞—Ü–∏—é
                    break;
                case 'intermediate':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 10).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 7).map(t => t.id);
                    metaProtocolIds = ['MP1', 'MP2']; // –î–æ–±–∞–≤–∏–º –∞–¥–∞–ø—Ç–∞—Ü–∏—é –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
                    break;
                case 'expert':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 20).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 15).map(t => t.id);
                    metaProtocolIds = ['MP1', 'MP2', 'MP3']; // –í—Å–µ –∫—Ä–æ–º–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏–µ–º
                    break;
            }
            protocolIds.forEach(id => selectedProtocols.add(id));
            toolIds.forEach(id => selectedTools.add(id));
            metaProtocolIds.forEach(id => selectedMetaProtocols.add(id)); // –ù–û–í–û–ï
            updateUI();
            renderMetaProtocols(); // –ù–û–í–û–ï
            showNotification(`–ü—Ä–µ—Å–µ—Ç "${getPresetName(preset)}" –ø—Ä–∏–º–µ–Ω–µ–Ω!`);
        };

        // --- –ù–û–í–û–ï: –£–º–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã ---
        const applySmartPreset = (presetName) => {
            // –ü—Ä–∏–º–µ—Ä: –¥–ª—è "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö" - –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º
            const analysisProtocols = Object.values(protocolsData).flat().filter(p => p.name.toLowerCase().includes('–∞–Ω–∞–ª–∏–∑') || p.name.toLowerCase().includes('–ø–∞—Ç—Ç–µ—Ä–Ω')).slice(0, 8).map(p => p.id);
            const analysisTools = Object.values(toolsData).flat().filter(t => t.name.toLowerCase().includes('analysis') || t.name.toLowerCase().includes('pattern')).slice(0, 5).map(t => t.id);
            resetAll();
            analysisProtocols.forEach(id => selectedProtocols.add(id));
            analysisTools.forEach(id => selectedTools.add(id));
            updateUI();
            showNotification(`–£–º–Ω—ã–π –ø—Ä–µ—Å–µ—Ç "${getSmartPresetName(presetName)}" –ø—Ä–∏–º–µ–Ω–µ–Ω!`);
        };

        const getSmartPresetName = (preset) => {
            const names = {
                'data-analysis': '–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö',
                'code-refactor': '–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞',
                'content-creation': '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞'
            };
            return names[preset] || preset;
        };
        // --- /–ù–û–í–û–ï ---

        const getPresetName = (preset) => {
            const names = {
                'novice': '–î–ª—è –Ω–æ–≤–∏—á–∫–∞',
                'intermediate': '–î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ',
                'expert': '–î–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞'
            };
            return names[preset] || preset;
        };

        const encodeBase64 = () => {
            if (selectedProtocols.size === 0 && selectedTools.size === 0 && selectedMetaProtocols.size === 0) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã!');
                return;
            }
            isBase64Encoded = true;
            updatePrompt();
            showNotification('–ü—Ä–æ–º—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ Base64!');
        };

        const decodeBase64 = () => {
            if (!isBase64Encoded) {
                showNotification('–ü—Ä–æ–º—Ç —É–∂–µ –≤ –æ–±—ã—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ!');
                return;
            }
            isBase64Encoded = false;
            updatePrompt();
            showNotification('–ü—Ä–æ–º—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –∏–∑ Base64!');
        };

        const showNotification = (message) => {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        };

        const openHelpModal = () => {
            document.getElementById('help-modal').style.display = 'flex';
        };

        const closeHelpModal = () => {
            document.getElementById('help-modal').style.display = 'none';
        };

        // --- –ù–û–í–û–ï: API ---
        const toggleApiSettings = () => {
            const settings = document.getElementById('api-settings');
            const btn = document.getElementById('toggle-api-btn');
            if (settings.style.display === 'block') {
                settings.style.display = 'none';
                btn.textContent = '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API';
            } else {
                settings.style.display = 'block';
                btn.textContent = '‚ùå –°–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
            }
        };

        const sendToApi = () => {
            const promptText = document.getElementById('prompt-preview').textContent;
            if (!promptText || promptText.includes('–í—ã–±–µ—Ä–∏—Ç–µ')) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º—Ç!');
                return;
            }
            const apiUrl = document.getElementById('api-url').value;
            const apiKey = document.getElementById('api-key').value;
            const model = document.getElementById('api-model').value;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è API OpenAI/Anthropic
            if (document.getElementById('api-provider').value !== 'ollama' && !apiKey) {
                showNotification('–î–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ API —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–ª—é—á!');
                return;
            }

            document.getElementById('api-response').style.display = 'block';
            document.getElementById('api-response').textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            document.getElementById('send-api-btn').disabled = true;

            // –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –¥–ª—è Ollama
            if (document.getElementById('api-provider').value === 'ollama') {
                fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: model,
                        prompt: promptText,
                        stream: false // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
                    })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('api-response').textContent = data.response || '–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω.';
                    document.getElementById('rating-section').style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ API:', error);
                    document.getElementById('api-response').textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                })
                .finally(() => {
                    document.getElementById('send-api-btn').disabled = false;
                });
            } else {
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è OpenAI/Anthropic
                document.getElementById('api-response').textContent = '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI/Anthropic —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—é—á–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.';
                document.getElementById('send-api-btn').disabled = false;
            }
        };

        const submitRating = (ratingValue) => {
            if (currentCore && (selectedProtocols.size > 0 || selectedTools.size > 0)) {
                const configForRating = {
                    core: currentCore,
                    activeProtocols: Array.from(selectedProtocols),
                    activeTools: Array.from(selectedTools),
                    rating: parseInt(ratingValue)
                };
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ IndexedDB
                saveToDB({ name: `Rating_${new Date().toISOString()}`, ...configForRating, timestamp: new Date().toISOString() })
                    .then(() => console.log('–û—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î'))
                    .catch(err => console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏:', err));
                showNotification(`–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É: ${ratingValue} –∑–≤—ë–∑–¥!`);
                // –°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –æ—Ü–µ–Ω–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                document.getElementById('rating-section').style.display = 'none';
            }
        };
        // --- /–ù–û–í–û–ï ---

        // --- –ù–û–í–û–ï: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ---
        const saveTemplate = () => {
            const name = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —à–∞–±–ª–æ–Ω–∞:');
            if (!name) return;
            const data = {
                name: name,
                timestamp: new Date().toISOString(),
                activeProtocols: Array.from(selectedProtocols),
                activeTools: Array.from(selectedTools),
                activeMetaProtocols: Array.from(selectedMetaProtocols),
                core: currentCore
            };
            saveToDB(data)
                .then(() => {
                    showNotification(`–®–∞–±–ª–æ–Ω "${name}" —Å–æ—Ö—Ä–∞–Ω—ë–Ω!`);
                    loadTemplatesFromDB(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                })
                .catch(err => {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:', err);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω.');
                });
        };

        const exportDB = () => {
            loadFromDB().then(data => {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'neural_architect_db_export.json';
                a.click();
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ë–î:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–î.');
            });
        };

        const clearDB = () => {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?')) return;
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.clear();
            request.onsuccess = () => {
                showNotification('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞.');
                loadTemplatesFromDB(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
            };
            request.onerror = () => {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ë–î:', request.error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –ë–î.');
            };
        };
        // --- /–ù–û–í–û–ï ---

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        document.addEventListener('DOMContentLoaded', async () => {
            await openDB(); // –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –ë–î
            renderTabs();
            renderMetaProtocols(); // –ù–û–í–û–ï
            renderProtocols();
            renderTools();
            document.getElementById('search-input').addEventListener('input', (e) => {
                const value = e.target.value;
                renderProtocols(value);
                renderTools(value);
            });
            document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
            document.getElementById('export-btn').addEventListener('click', exportJSON);
            document.getElementById('reset-btn').addEventListener('click', resetAll);
            document.getElementById('auto-select-btn').addEventListener('click', autoSelect);
            document.getElementById('encode-btn').addEventListener('click', encodeBase64);
            document.getElementById('decode-btn').addEventListener('click', decodeBase64);
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = btn.getAttribute('data-preset');
                    applyPreset(preset);
                });
            });
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–º–Ω—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤
            document.querySelectorAll('.smart-preset').forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = btn.getAttribute('data-smart-preset');
                    applySmartPreset(preset);
                });
            });
            // –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —è–¥—Ä–∞
            document.querySelectorAll('.core-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const coreId = btn.getAttribute('data-core');
                    toggleCore(coreId);
                });
            });
            // –ù–û–í–û–ï: API
            document.getElementById('toggle-api-btn').addEventListener('click', toggleApiSettings);
            document.getElementById('send-api-btn').addEventListener('click', sendToApi);
            // –ù–û–í–û–ï: –†–µ–π—Ç–∏–Ω–≥
            document.querySelectorAll('input[name="rating"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    submitRating(this.value);
                });
            });
            // –ù–û–í–û–ï: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
            document.getElementById('save-template-btn').addEventListener('click', saveTemplate);
            document.getElementById('export-db-btn').addEventListener('click', exportDB);
            document.getElementById('clear-db-btn').addEventListener('click', clearDB);
            document.getElementById('load-template-btn').addEventListener('click', () => {
                // –ö–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É "–ú–æ—è –ë–∞–∑–∞" —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–ø–∏—Å–∫–∞
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫
                loadTemplatesFromDB();
                showNotification('–°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω.');
            });
            document.getElementById('tools-help').addEventListener('click', openHelpModal);
            document.getElementById('prompt-help').addEventListener('click', openHelpModal);
            document.getElementById('close-help').addEventListener('click', closeHelpModal);
            const statusIndicator = document.getElementById('system-status');
            const statusText = document.getElementById('status-text');
            setInterval(() => {
                statusIndicator.classList.toggle('active');
                statusText.textContent = statusIndicator.classList.contains('active') ? '–ê–ö–¢–ò–í–ï–ù' : '–ì–û–¢–û–í';
            }, 2000);
        });
    </script>
</body>
</html>