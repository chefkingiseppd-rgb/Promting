<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURAL_ARCHITECT_PREMIORBIT++++ v25.0 - СПАСЁННЫЙ ПРОФЕССИОНАЛЬНЫЙ ИНСТРУМЕНТ</title>
    <style>
        :root {
            /* Светло-серая палитра с акцентами */
            --bg-primary: #0a0a1a;
            --bg-secondary: #121220;
            --bg-tertiary: #1a1a2e;
            --bg-card: rgba(10, 15, 30, 0.9);
            --bg-card-hover: rgba(20, 25, 45, 0.95);
            --accent-primary: #00f0ff; /* Неоновый голубой */
            --accent-secondary: #00c8ff; /* Более тёмный голубой */
            --accent-tertiary: #00b0ff; /* Голубой для акцентов */
            --accent-positive: #00ffaa; /* Зелёный успех */
            --accent-negative: #ff4444; /* Красный ошибка */
            --accent-warning: #ffcc00; /* Жёлтый предупреждение */
            --text-primary: #ffffff; /* Белый */
            --text-secondary: #cccccc; /* Светло-серый */
            --text-muted: #999999; /* Приглушённый серый */
            --border: rgba(0, 240, 255, 0.2); /* Неоновая граница */
            --hover: rgba(0, 240, 255, 0.1); /* Лёгкий неон при наведении */
            --selected: rgba(0, 240, 255, 0.2); /* Выделение */
            --neuron-node: #00b0ff; /* Цвет узла нейросети */
            --neuron-connection: rgba(0, 240, 255, 0.3); /* Цвет связи */
            --neuron-active: #00ffaa; /* Цвет активного узла */
            --glow-primary: 0 0 15px rgba(0, 240, 255, 0.5); /* Свечение акцента */
            --glow-secondary: 0 0 10px rgba(0, 200, 255, 0.4); /* Свечение фиолета */
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --transition-fast: all 0.2s ease-out;
            --transition-slow: all 0.6s ease-in-out;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            background-image:
                radial-gradient(ellipse at 10% 20%, rgba(0, 240, 255, 0.05) 0%, transparent 20%),
                radial-gradient(ellipse at 90% 80%, rgba(0, 200, 255, 0.05) 0%, transparent 20%),
                linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-tertiary) 100%);
            background-size: cover;
            background-attachment: fixed;
            position: relative;
            min-height: 100vh;
            line-height: 1.6;
        }
        /* Контеинер для нейросети */
        #neural-network-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.6;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        /* Основной контейнер */
        .container {
            display: flex;
            min-height: 100vh;
            padding: 1.5rem;
            gap: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
        }
        /* Боковая панель */
        .sidebar {
            width: 300px;
            background: var(--bg-card);
            padding: 1.75rem;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), var(--glow-primary);
            border: 1px solid var(--border);
            transition: box-shadow 0.3s ease;
        }
        .sidebar:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), var(--glow-primary), var(--glow-secondary);
        }
        .header {
            text-align: center;
            margin-bottom: 1.75rem;
        }
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 0.3rem;
            color: var(--accent-primary);
            text-shadow: var(--glow-primary);
            letter-spacing: 0.5px;
        }
        .header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .author {
            color: var(--accent-tertiary);
            font-style: italic;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.1rem;
            margin-bottom: 1.75rem;
        }
        .stat-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.25rem;
        }
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--accent-positive);
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
            box-shadow: var(--glow-primary);
        }
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        .btn {
            padding: 0.8rem 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            margin-bottom: 0.7rem;
            text-align: center;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 240, 255, 0.4), var(--glow-primary); }
        .btn-primary:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--hover); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
        .btn-success { background: linear-gradient(135deg, var(--accent-positive), #00ff88); color: white; }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 255, 170, 0.3); }
        .btn-warning { background: linear-gradient(135deg, var(--accent-warning), #ffbb00); color: white; }
        .btn-warning:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(255, 204, 0, 0.3); }
        .btn-danger { background: linear-gradient(135deg, var(--accent-negative), #ff6666); color: white; }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(255, 68, 68, 0.3); }
        .input-group {
            margin-bottom: 1.2rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.6rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.85rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 240, 255, 0.2), var(--glow-primary);
        }
        /* Основная область */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.75rem;
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), var(--glow-primary);
            border: 1px solid var(--border);
            transition: box-shadow 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), var(--glow-primary), var(--glow-secondary);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .help-icon {
            background: var(--bg-tertiary);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: help;
            font-size: 1rem;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .help-icon:hover {
            background: var(--hover);
            color: var(--accent-primary);
            transform: scale(1.1);
            box-shadow: var(--glow-primary);
        }
        /* Прогресс-бары */
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1.2rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-warning), var(--accent-positive));
            width: 0%;
            transition: width 0.8s cubic-bezier(0.42, 0, 0.58, 1);
            border-radius: 6px;
        }
        .power-meter, .expertise-meter {
            width: 100%;
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.7rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .power-fill, .expertise-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            width: 0%;
            transition: width 0.8s cubic-bezier(0.42, 0, 0.58, 1);
            border-radius: 4px;
        }
        .expertise-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: right;
            font-weight: 500;
        }
        /* Категории */
        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.7rem;
            margin-bottom: 1.2rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        .category-btn {
            padding: 0.6rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            font-weight: 500;
        }
        .category-btn:hover {
            background: var(--hover);
            transform: translateY(-1px);
        }
        .category-btn.active {
            background: var(--selected);
            color: var(--accent-primary);
            border-color: var(--accent-primary);
            box-shadow: var(--glow-primary);
        }
        /* Элементы протоколов/инструментов */
        .protocol-item, .tool-item, .kernel-item, .hypervisor-item, .supervisor-item, .meta-item, .program-item {
            background: var(--bg-secondary);
            padding: 1.1rem;
            border-radius: 10px;
            margin-bottom: 0.9rem;
            border: 1px solid var(--border);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 0.85rem;
        }
        .protocol-item:hover, .tool-item:hover, .kernel-item:hover, .hypervisor-item:hover, .supervisor-item:hover, .meta-item:hover, .program-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .protocol-item.selected, .tool-item.selected, .kernel-item.selected, .hypervisor-item.selected, .supervisor-item.selected, .meta-item.selected, .program-item.selected {
            background: var(--selected);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary), var(--glow-primary);
        }
        .item-toggle {
            font-size: 1.4rem;
            line-height: 1;
            transition: var(--transition-fast);
        }
        .protocol-item.selected .item-toggle, .tool-item.selected .item-toggle, .kernel-item.selected .item-toggle, .hypervisor-item.selected .item-toggle, .supervisor-item.selected .item-toggle, .meta-item.selected .item-toggle, .program-item.selected .item-toggle {
            transform: scale(1.2);
            color: var(--accent-positive);
        }
        .item-content {
            flex: 1;
        }
        .item-name {
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 0.3rem;
            font-size: 1rem;
        }
        .item-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .info-icon {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--bg-tertiary);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            border: 1px solid var(--border);
            cursor: help;
            transition: all 0.2s ease;
        }
        .info-icon:hover {
            background: var(--hover);
            color: var(--accent-primary);
            transform: scale(1.2);
            box-shadow: var(--glow-primary);
        }
        /* Предпросмотр промта */
        .prompt-preview {
            width: 100%;
            min-height: 220px;
            max-height: 40vh;
            padding: 1.2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', 'Consolas', 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-y: auto;
            resize: vertical;
            font-size: 0.95rem;
            line-height: 1.5;
            transition: border-color 0.3s ease;
        }
        .prompt-preview:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(0, 240, 255, 0.2);
        }
        .token-counter {
            margin-top: 0.85rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: right;
            font-weight: 500;
        }
        /* Кнопки кодирования */
        .encoding-controls {
            display: flex;
            gap: 0.7rem;
            margin-top: 1.1rem;
            flex-wrap: wrap;
        }
        /* Кнопки мессенджеров */
        .messenger-controls {
            display: flex;
            gap: 0.7rem;
            margin-top: 1.1rem;
        }
        .messenger-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .messenger-btn-whatsapp { background: linear-gradient(135deg, #25D366, #128C7E); color: white; }
        .messenger-btn-whatsapp:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(37, 211, 102, 0.4); }
        .messenger-btn-telegram { background: linear-gradient(135deg, #0088cc, #006699); color: white; }
        .messenger-btn-telegram:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 136, 204, 0.4); }
        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-card);
            padding: 2.2rem;
            border-radius: 16px;
            width: 85%;
            max-width: 750px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), var(--glow-primary);
            max-height: 85vh;
            overflow-y: auto;
            animation: modalAppear 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.7rem;
        }
        .modal-title {
            font-size: 1.4rem;
            color: var(--accent-primary);
            font-weight: 600;
        }
        .close-modal {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .close-modal:hover {
            background: var(--hover);
            color: var(--accent-primary);
            transform: scale(1.1);
        }
        .template-manager {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        .template-item {
            padding: 1.2rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        .template-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .template-item h4 {
            color: var(--accent-primary);
            margin-bottom: 0.4rem;
            font-size: 1.1rem;
        }
        .template-item p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1.1rem 1.6rem;
            background: linear-gradient(135deg, var(--accent-positive), #34d399);
            color: white;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), var(--glow-primary);
            z-index: 3001;
            display: none;
            min-width: 280px;
            font-weight: 500;
        }
        .notification.show {
            display: block;
            animation: fadeInOut 3.2s ease;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; right: 0; transform: translateX(100%); }
            10% { opacity: 1; right: 20px; transform: translateX(0); }
            90% { opacity: 1; right: 20px; transform: translateX(0); }
            100% { opacity: 0; right: 0; transform: translateX(100%); }
        }
        /* Адаптивность */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 1rem;
            }
            .sidebar {
                width: 100%;
                margin-bottom: 1.2rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .messenger-controls {
                flex-direction: column;
            }
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
        }
        /* Стили для страниц */
        .page {
            display: none;
            width: 100%;
            height: 100%;
        }
        .page.active {
            display: block;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        .page-title {
            font-size: 1.5rem;
            color: var(--accent-primary);
        }
        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .nav-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        .nav-btn:hover:not(.disabled) {
            background: var(--hover);
        }
        .nav-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .page-content {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .page-section {
            flex: 1;
            min-width: 300px;
        }
        .page-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        /* Стили для прокрутки */
        .scrollable-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-secondary);
        }
        .scrollable-container::-webkit-scrollbar {
            width: 8px;
        }
        .scrollable-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 10px;
        }
        .scrollable-container::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 10px;
        }
        .scrollable-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }
    </style>
</head>
<body>
    <!-- Контеинер для визуализации нейросети -->
    <div id="neural-network-container">
        <canvas id="neuralCanvas"></canvas>
    </div>
    <!-- Основной контейнер приложения -->
    <div class="container">
        <!-- Боковая панель -->
        <div class="sidebar">
            <div class="header">
                <h1>NEURAL_ARCHITECT v25.0</h1>
                <p>СПАСЁННЫЙ Профессиональный Инструмент</p>
                <div class="author">Автор: Смолянинов А.В.</div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="active-count">0</div>
                    <div class="stat-label">АКТИВНО</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="power-level">0%</div>
                    <div class="stat-label">МОЩНОСТЬ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value"><span class="status-indicator"></span><span id="status-text">ГОТОВ</span></div>
                    <div class="stat-label">СТАТУС</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="expertise-level">0%</div>
                    <div class="stat-label">ЭКСПЕРТИЗА</div>
                </div>
            </div>
            <button class="btn btn-primary" id="auto-select-btn">🤖 Автоподбор для Новичка</button>
            <button class="btn btn-secondary" id="preset-novice-btn">Пресет: Новичок</button>
            <button class="btn btn-secondary" id="preset-intermediate-btn">Пресет: Средний</button>
            <button class="btn btn-secondary" id="preset-expert-btn">Пресет: Эксперт</button>
            <button class="btn btn-danger" id="reset-btn">❌ Сбросить все</button>
            <div class="input-group">
                <label for="search-input">🔍 Поиск протоколов/инструментов:</label>
                <input type="text" id="search-input" placeholder="Введите название...">
            </div>
            <!-- Мета-инструменты -->
            <div class="input-group">
                <label for="meta-instrument">🧠 Мета-инструменты:</label>
                <select id="meta-instrument">
                    <option value="none">Выберите мета-инструмент</option>
                    <option value="hypervisor">Гипервизор (Координация)</option>
                    <option value="core">Ядро (Анализ)</option>
                    <option value="synthesis">Синтез (Интеграция)</option>
                    <option value="optimizer">Оптимизатор (Эффективность)</option>
                </select>
            </div>
            <button class="btn btn-warning" id="apply-meta-btn">Применить Мета-инструмент</button>
        </div>
        <!-- Основное содержимое -->
        <div class="main-content">
            <!-- Страница 1: Выбор протоколов -->
            <div id="page-protocols" class="page active">
                <div class="page-header">
                    <div class="page-title">📝 Шаг 1: Выбор Протоколов</div>
                    <div class="nav-buttons">
                        <button class="nav-btn disabled" id="nav-prev-protocols">← Назад</button>
                        <button class="nav-btn" id="nav-next-protocols">Далее →</button>
                    </div>
                </div>
                <div class="page-content">
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Протоколы</div>
                                <div class="help-icon" id="protocols-help">?</div>
                            </div>
                            <div class="category-selector" id="protocols-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="protocols-container">
                                <!-- Протоколы будут добавлены JS -->
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Ядра и Гипервайзеры</div>
                            </div>
                            <div class="category-selector" id="kernels-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="kernels-container">
                                <!-- Ядра будут добавлены JS -->
                            </div>
                            <div class="category-selector" id="hypervisors-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="hypervisors-container">
                                <!-- Гипервайзеры будут добавлены JS -->
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Статистика</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <div class="power-meter">
                                <div class="power-fill" id="power-meter"></div>
                            </div>
                            <div class="expertise-meter">
                                <div class="expertise-fill" id="expertise-meter"></div>
                            </div>
                            <div class="expertise-label" id="expertise-label">Уровень: Новичок (0%)</div>
                        </div>
                    </div>
                </div>
                <div class="page-footer">
                    <button class="btn btn-secondary disabled" id="footer-prev-protocols">← Назад</button>
                    <button class="btn btn-primary" id="footer-next-protocols">Далее →</button>
                </div>
            </div>
            <!-- Страница 2: Выбор инструментов -->
            <div id="page-tools" class="page">
                <div class="page-header">
                    <div class="page-title">🛠 Шаг 2: Выбор Инструментов</div>
                    <div class="nav-buttons">
                        <button class="nav-btn" id="nav-prev-tools">← Назад</button>
                        <button class="nav-btn" id="nav-next-tools">Далее →</button>
                    </div>
                </div>
                <div class="page-content">
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Инструменты</div>
                                <div class="help-icon" id="tools-help">?</div>
                            </div>
                            <div class="category-selector" id="tools-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="tools-container">
                                <!-- Инструменты будут добавлены JS -->
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Супервайзеры и Мета-инструменты</div>
                            </div>
                            <div class="category-selector" id="supervisors-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="supervisors-container">
                                <!-- Супервайзеры будут добавлены JS -->
                            </div>
                            <div class="category-selector" id="meta-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="meta-container">
                                <!-- Мета-инструменты будут добавлены JS -->
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Статистика</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill-tools"></div>
                            </div>
                            <div class="power-meter">
                                <div class="power-fill" id="power-meter-tools"></div>
                            </div>
                            <div class="expertise-meter">
                                <div class="expertise-fill" id="expertise-meter-tools"></div>
                            </div>
                            <div class="expertise-label" id="expertise-label-tools">Уровень: Новичок (0%)</div>
                        </div>
                    </div>
                </div>
                <div class="page-footer">
                    <button class="btn btn-secondary" id="footer-prev-tools">← Назад</button>
                    <button class="btn btn-primary" id="footer-next-tools">Далее →</button>
                </div>
            </div>
            <!-- Страница 3: Выбор готовых программ -->
            <div id="page-programs" class="page">
                <div class="page-header">
                    <div class="page-title">📋 Шаг 3: Выбор Готовых Программ</div>
                    <div class="nav-buttons">
                        <button class="nav-btn" id="nav-prev-programs">← Назад</button>
                        <button class="nav-btn" id="nav-next-programs">Далее →</button>
                    </div>
                </div>
                <div class="page-content">
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Готовые Программы</div>
                                <div class="help-icon" id="programs-help">?</div>
                            </div>
                            <div class="category-selector" id="programs-category-selector">
                                <!-- Категории будут добавлены JS -->
                            </div>
                            <div class="scrollable-container" id="programs-container">
                                <!-- Программы будут добавлены JS -->
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Статистика</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill-programs"></div>
                            </div>
                            <div class="power-meter">
                                <div class="power-fill" id="power-meter-programs"></div>
                            </div>
                            <div class="expertise-meter">
                                <div class="expertise-fill" id="expertise-meter-programs"></div>
                            </div>
                            <div class="expertise-label" id="expertise-label-programs">Уровень: Новичок (0%)</div>
                        </div>
                    </div>
                </div>
                <div class="page-footer">
                    <button class="btn btn-secondary" id="footer-prev-programs">← Назад</button>
                    <button class="btn btn-primary" id="footer-next-programs">Далее →</button>
                </div>
            </div>
            <!-- Страница 4: Генерация промта -->
            <div id="page-prompt" class="page">
                <div class="page-header">
                    <div class="page-title">📝 Шаг 4: Генерация Промта</div>
                    <div class="nav-buttons">
                        <button class="nav-btn" id="nav-prev-prompt">← Назад</button>
                        <button class="nav-btn disabled" id="nav-next-prompt">Далее →</button>
                    </div>
                </div>
                <div class="page-content">
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Сгенерированный Промт</div>
                                <div class="help-icon" id="prompt-help">?</div>
                            </div>
                            <pre class="prompt-preview" id="prompt-preview">Выберите протоколы, инструменты, ядра, гипервайзеры, супервайзеры, мета-инструменты и готовые программы для генерации промта...</pre>
                            <div class="token-counter">Токены: <span id="token-count">0</span> | Символы: <span id="char-count">0</span></div>
                            <div class="encoding-controls">
                                <button class="btn btn-success" id="copy-btn">📋 Копировать</button>
                                <button class="btn btn-warning" id="encode-btn">Encode Base64</button>
                                <button class="btn btn-warning" id="decode-btn">Decode Base64</button>
                            </div>
                            <div class="messenger-controls">
                                <button class="messenger-btn messenger-btn-whatsapp" id="send-whatsapp-btn">
                                    💬 WhatsApp
                                </button>
                                <button class="messenger-btn messenger-btn-telegram" id="send-telegram-btn">
                                    📱 Telegram
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="page-section">
                        <div class="card">
                            <div class="section-header">
                                <div class="section-title">Метаданные</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill-final"></div>
                            </div>
                            <div class="power-meter">
                                <div class="power-fill" id="power-meter-final"></div>
                            </div>
                            <div class="expertise-meter">
                                <div class="expertise-fill" id="expertise-meter-final"></div>
                            </div>
                            <div class="expertise-label" id="expertise-label-final">Уровень: Новичок (0%)</div>
                            <div class="input-group">
                                <label for="author-name">✍️ Автор промта:</label>
                                <input type="text" id="author-name" placeholder="Введите имя автора..." value="Смолянинов А.В." readonly>
                            </div>
                            <div class="input-group">
                                <label for="version-number">🔢 Версия промта:</label>
                                <input type="text" id="version-number" placeholder="Введите версию..." value="v25.0" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-footer">
                    <button class="btn btn-secondary" id="footer-prev-prompt">← Назад</button>
                    <button class="btn btn-success" id="footer-finish">✅ Завершить и Визуализировать</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Модальное окно для справки -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Справка по использованию</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="help-content">
                <p>Добро пожаловать в <strong>NEURAL_ARCHITECT v25.0</strong> – спасённый, эстетичный и мощный инструмент для создания экспертных промтов.</p>
                <h4>Как пользоваться:</h4>
                <ol>
                    <li><strong>Шаг 1: Выбор протоколов.</strong> Перейдите на вкладку "Протоколы". Выберите нужные категории. Кликните по элементу, чтобы добавить его. Также выберите Ядра и Гипервайзеры.</li>
                    <li><strong>Шаг 2: Выбор инструментов.</strong> Аналогично выберите инструменты, Супервайзеры и Мета-инструменты.</li>
                    <li><strong>Шаг 3: Выбор готовых программ.</strong> Выберите готовые программы, которые представляют собой подборки элементов.</li>
                    <li><strong>Шаг 4: Генерация промта.</strong> На этой странице вы увидите сформированный промт. Вы можете скопировать его или отправить в мессенджер.</li>
                    <li><strong>Завершение:</strong> Нажмите "✅ Завершить и Визуализировать". Это откроет новое окно с визуализацией промта в виде нейросети.</li>
                    <li><strong>Мета-инструменты:</strong> В боковой панели выберите мета-инструмент (например, "Гипервизор") и нажмите "Применить". Это добавит специальный протокол в промт.</li>
                    <li><strong>Автоподбор:</strong> Используйте кнопку "🤖 Автоподбор для Новичка".</li>
                </ol>
            </div>
        </div>
    </div>
    <!-- Модальное окно для шаблонов -->
    <div class="modal" id="templates-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Шаблоны Задач</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="template-manager">
                <div class="template-item" onclick="loadTemplate('content-creation')">
                    <h4>Создание контента</h4>
                    <p>Промт для генерации статьи, постов, сценариев и т.д.</p>
                </div>
                <div class="template-item" onclick="loadTemplate('data-analysis')">
                    <h4>Анализ данных</h4>
                    <p>Промт для обработки и интерпретации наборов данных.</p>
                </div>
                <div class="template-item" onclick="loadTemplate('code-generation')">
                    <h4>Генерация кода</h4>
                    <p>Промт для написания кода на различных языках.</p>
                </div>
                <div class="template-item" onclick="loadTemplate('creative-writing')">
                    <h4>Креативное письмо</h4>
                    <p>Промт для написания рассказов, стихов, творческих текстов.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Уведомление -->
    <div class="notification" id="notification">Промт успешно скопирован!</div>
    <script>
        // --- Генерация данных ---
        const generateProtocols = () => {
            const categories = ['Анализ', 'Инженерия', 'Качество', 'Оптимизация', 'Мета-управление','Обучение', 'Адаптация', 'Безопасность', 'Интеграция', 'Визуализация'];
            const actions = ['Анализ', 'Контроль', 'Оптимизация', 'Мониторинг', 'Синтез','Координация', 'Адаптация', 'Валидация', 'Симуляция', 'Прогноз','Декомпозиция', 'Гарантия', 'Эскалация', 'Передача', 'Накопление'];
            const objects = ['Данные', 'Процессы', 'Ресурсы', 'Риски', 'Эффективность','Качество', 'Стабильность', 'Производительность', 'Точность', 'Надежность','Факты', 'Паттерны', 'Гипотезы', 'Решения', 'Знания'];
            const protocols = [];
            let id = 1;
            for (let i = 0; i < 100; i++) {
                const cat = categories[Math.floor(Math.random() * categories.length)];
                const act = actions[Math.floor(Math.random() * actions.length)];
                const obj = objects[Math.floor(Math.random() * objects.length)];
                protocols.push({
                    id: `P${id++}`,
                    name: `${act} ${obj}`,
                    desc: `Протокол ${act.toLowerCase()} для ${obj.toLowerCase()} в категории ${cat}`,
                    category: cat,
                    instruction: `## ${act} ${obj}
- Задача должна быть решена с любой сложностью
- Обеспечить максимальную точность и надежность
- Провести глубокий анализ и декомпозицию
- Гарантировать оригинальность решения
- Адаптироваться к контексту запроса`
                });
            }
            const grouped = {};
            protocols.forEach(p => {
                if (!grouped[p.category]) grouped[p.category] = [];
                grouped[p.category].push(p);
            });
            return grouped;
        };
        const generateTools = () => {
            const toolCategories = ['Технические', 'Аналитические', 'Коммуникационные', 'Специализированные', 'Оптимизационные'];
            const toolTypes = ['Python', 'PyTorch', 'JAX', 'Chain-of-Thought', 'Few-Shot Learning', 'QLoRA', 'JSON', 'SQL', 'REST API', 'TensorFlow', 'NumPy', 'SciPy', 'OpenCV', 'WebGL', 'Three.js'];
            const tools = [];
            let id = 1;
            for (let i = 0; i < 100; i++) {
                const cat = toolCategories[Math.floor(Math.random() * toolCategories.length)];
                const type = toolTypes[Math.floor(Math.random() * toolTypes.length)];
                tools.push({
                    id: `T${id++}`,
                    name: type,
                    desc: `Инструмент ${type} для решения задач в категории ${cat}`,
                    category: cat,
                    instruction: `### Инструмент: ${type}
- Используйте этот инструмент для решения задач, требующих ${type.toLowerCase()}
- Обеспечьте максимальную эффективность и точность
- Интегрируйте с другими инструментами для комплексного решения
- Адаптируйте под конкретную задачу и контекст
- Гарантируйте работоспособность и надежность`
                });
            }
            const grouped = {};
            tools.forEach(t => {
                if (!grouped[t.category]) grouped[t.category] = [];
                grouped[t.category].push(t);
            });
            return grouped;
        };
        const generateKernels = () => {
            const kernels = [];
            for (let i = 1; i <= 20; i++) {
                kernels.push({
                    id: `K${i}`,
                    name: `Ядро ${i}`,
                    desc: `Анализирующее ядро ${i} для обработки и синтеза информации`,
                    category: 'Ядра',
                    instruction: `### Ядро ${i}
- Основной аналитический и синтезирующий компонент
- Обрабатывает все входные данные и инструкции
- Гарантирует логическую целостность и согласованность`
                });
            }
            return { 'Ядра': kernels };
        };
        const generateHypervisors = () => {
            const hypervisors = [];
            for (let i = 1; i <= 20; i++) {
                hypervisors.push({
                    id: `HV${i}`,
                    name: `Гипервизор ${i}`,
                    desc: `Координирующий гипервизор ${i} для синхронизации компонентов`,
                    category: 'Гипервайзеры',
                    instruction: `### Гипервизор ${i}
- Основной координирующий и управляющий компонент
- Синхронизирует работу всех активных протоколов и инструментов
- Обеспечивает стабильность и производительность системы`
                });
            }
            return { 'Гипервайзеры': hypervisors };
        };
        const generateSupervisors = () => {
            const supervisors = [];
            for (let i = 1; i <= 20; i++) {
                supervisors.push({
                    id: `SV${i}`,
                    name: `Супервайзер ${i}`,
                    desc: `Надзорный супервайзер ${i} для контроля и мониторинга`,
                    category: 'Супервайзеры',
                    instruction: `### Супервайзер ${i}
- Основной надзорный и контролирующий компонент
- Мониторит выполнение задач и соблюдение инструкций
- Обеспечивает точность и надежность результата`
                });
            }
            return { 'Супервайзеры': supervisors };
        };
        const generateMetaInstruments = () => {
            const metaInstruments = [];
            for (let i = 1; i <= 40; i++) {
                metaInstruments.push({
                    id: `MI${i}`,
                    name: `Мета-инструмент ${i}`,
                    desc: `Мета-инструмент ${i} для интеграции и оптимизации`,
                    category: 'Мета-инструменты',
                    instruction: `### Мета-инструмент ${i}
- Основной интегрирующий и оптимизирующий компонент
- Объединяет логику всех выбранных элементов
- Повышает общую эффективность и адаптивность`
                });
            }
            return { 'Мета-инструменты': metaInstruments };
        };
        const generatePrograms = () => {
            const programs = [];
            const programTypes = ['Анализ', 'Создание', 'Оптимизация', 'Интеграция', 'Синтез'];
            for (let i = 1; i <= 40; i++) {
                const type = programTypes[Math.floor(Math.random() * programTypes.length)];
                programs.push({
                    id: `PR${i}`,
                    name: `Программа ${type} ${i}`,
                    desc: `Готовая программа ${type.toLowerCase()} ${i}, преднастроена для решения задач типа ${type}`,
                    category: 'Программы',
                    instruction: `### Программа ${type} ${i}
- Готовое решение для задач типа ${type}
- Включает в себя подбор протоколов и инструментов
- Оптимизирована для эффективности и точности`
                });
            }
            return { 'Программы': programs };
        };

        // --- Инициализация данных ---
        const protocolsData = generateProtocols();
        const toolsData = generateTools();
        const kernelsData = generateKernels();
        const hypervisorsData = generateHypervisors();
        const supervisorsData = generateSupervisors();
        const metaInstrumentsData = generateMetaInstruments();
        const programsData = generatePrograms();

        // --- Состояние приложения ---
        let selectedProtocols = new Set();
        let selectedTools = new Set();
        let selectedKernels = new Set();
        let selectedHypervisors = new Set();
        let selectedSupervisors = new Set();
        let selectedMetaInstruments = new Set();
        let selectedPrograms = new Set();
        let isBase64Encoded = false;
        let selectedMetaInstrument = null; // Для боковой панели
        let currentPage = 'page-protocols'; // Текущая страница

        // --- Элементы DOM ---
        const activeCountEl = document.getElementById('active-count');
        const powerLevelEl = document.getElementById('power-level');
        const expertiseLevelEl = document.getElementById('expertise-level');
        const progressFillEl = document.getElementById('progress-fill');
        const powerMeterEl = document.getElementById('power-meter');
        const expertiseMeterEl = document.getElementById('expertise-meter');
        const expertiseLabelEl = document.getElementById('expertise-label');
        const promptPreviewEl = document.getElementById('prompt-preview');
        const tokenCountEl = document.getElementById('token-count');
        const charCountEl = document.getElementById('char-count');
        const searchInputEl = document.getElementById('search-input');
        const notificationEl = document.getElementById('notification');
        const metaInstrumentSelect = document.getElementById('meta-instrument');
        const applyMetaBtn = document.getElementById('apply-meta-btn');

        // --- Визуализация нейросети ---
        const initNeuralNetwork = () => {
            const canvas = document.getElementById('neuralCanvas');
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            window.addEventListener('resize', () => {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            });
            const nodes = [];
            const connections = [];
            const nodeCount = 100;
            const connectionProbability = 0.02;
            for (let i = 0; i < nodeCount; i++) {
                nodes.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.2,
                    vy: (Math.random() - 0.5) * 0.2,
                    radius: Math.random() * 1.5 + 0.5,
                    baseRadius: 0
                });
            }
            for (let i = 0; i < nodeCount; i++) {
                for (let j = i + 1; j < nodeCount; j++) {
                    if (Math.random() < connectionProbability) {
                        connections.push({ start: i, end: j });
                    }
                }
            }
            const activateNodes = () => {
                const activationCount = Math.min(15, selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 5 : 0));
                for (let i = 0; i < activationCount; i++) {
                    const node = nodes[Math.floor(Math.random() * nodes.length)];
                    node.baseRadius = 4;
                    setTimeout(() => { node.baseRadius = 0; }, 600);
                }
            };
            const animate = () => {
                ctx.clearRect(0, 0, width, height);
                nodes.forEach(node => {
                    node.x += node.vx;
                    node.y += node.vy;
                    if (node.x <= 0 || node.x >= width) node.vx *= -1;
                    if (node.y <= 0 || node.y >= height) node.vy *= -1;
                });
                ctx.strokeStyle = varGet('--neuron-connection');
                ctx.lineWidth = 0.5;
                connections.forEach(conn => {
                    const startNode = nodes[conn.start];
                    const endNode = nodes[conn.end];
                    ctx.beginPath();
                    ctx.moveTo(startNode.x, startNode.y);
                    ctx.lineTo(endNode.x, endNode.y);
                    ctx.stroke();
                });
                nodes.forEach(node => {
                    const radius = node.baseRadius > 0 ? node.baseRadius : node.radius;
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, radius, 0, Math.PI * 2);
                    ctx.fillStyle = varGet('--neuron-node');
                    ctx.fill();
                    if (node.baseRadius > 0) {
                        ctx.beginPath();
                        ctx.arc(node.x, node.y, radius + 1.5, 0, Math.PI * 2);
                        ctx.strokeStyle = varGet('--neuron-active');
                        ctx.lineWidth = 1.5;
                        ctx.stroke();
                    }
                });
                requestAnimationFrame(animate);
            };
            animate();
            window.addEventListener('neuralActivation', activateNodes);
            function varGet(prop) {
                return getComputedStyle(document.documentElement).getPropertyValue(prop).trim();
            }
        };

        // --- Функции управления страницами ---
        const showPage = (pageId) => {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            // Обновляем данные на страницах
            if (pageId === 'page-protocols') {
                updateProtocolsPage();
                document.querySelectorAll('#nav-prev-protocols, #footer-prev-protocols').forEach(btn => btn.classList.add('disabled'));
                document.querySelectorAll('#nav-next-protocols, #footer-next-protocols').forEach(btn => btn.classList.remove('disabled'));
            } else if (pageId === 'page-tools') {
                updateToolsPage();
                document.querySelectorAll('#nav-prev-tools, #footer-prev-tools').forEach(btn => btn.classList.remove('disabled'));
                document.querySelectorAll('#nav-next-tools, #footer-next-tools').forEach(btn => btn.classList.remove('disabled'));
            } else if (pageId === 'page-programs') {
                updateProgramsPage();
                document.querySelectorAll('#nav-prev-programs, #footer-prev-programs').forEach(btn => btn.classList.remove('disabled'));
                document.querySelectorAll('#nav-next-programs, #footer-next-programs').forEach(btn => btn.classList.remove('disabled'));
            } else if (pageId === 'page-prompt') {
                updatePromptPage();
                document.querySelectorAll('#nav-prev-prompt, #footer-prev-prompt').forEach(btn => btn.classList.remove('disabled'));
                document.querySelectorAll('#nav-next-prompt, #footer-next-programs').forEach(btn => btn.classList.add('disabled'));
            }
        };
        const updateProtocolsPage = () => {
            renderProtocols(document.querySelector('#protocols-category-selector .active')?.textContent || Object.keys(protocolsData)[0]);
            renderKernels(document.querySelector('#kernels-category-selector .active')?.textContent || Object.keys(kernelsData)[0]);
            renderHypervisors(document.querySelector('#hypervisors-category-selector .active')?.textContent || Object.keys(hypervisorsData)[0]);
            updateCounters();
        };
        const updateToolsPage = () => {
            renderTools(document.querySelector('#tools-category-selector .active')?.textContent || Object.keys(toolsData)[0]);
            renderSupervisors(document.querySelector('#supervisors-category-selector .active')?.textContent || Object.keys(supervisorsData)[0]);
            renderMetaInstruments(document.querySelector('#meta-category-selector .active')?.textContent || Object.keys(metaInstrumentsData)[0]);
            updateCounters();
        };
        const updateProgramsPage = () => {
            renderPrograms(document.querySelector('#programs-category-selector .active')?.textContent || Object.keys(programsData)[0]);
            updateCounters();
        };
        const updatePromptPage = () => {
            updatePrompt();
            updateTokenCount();
            const totalSelected = selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 1 : 0);
            const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
            const expertiseLevel = Math.min(100, Math.floor(totalSelected * 0.4));
            document.getElementById('progress-fill-final').style.width = powerLevel + '%';
            document.getElementById('power-meter-final').style.width = powerLevel + '%';
            document.getElementById('expertise-meter-final').style.width = expertiseLevel + '%';
            document.getElementById('expertise-label-final').textContent = `Уровень: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
        };

        // --- Функции обновления UI ---
        const updateCounters = () => {
            const totalSelected = selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 1 : 0);
            activeCountEl.textContent = totalSelected;
            const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
            powerLevelEl.textContent = powerLevel + '%';
            powerMeterEl.style.width = powerLevel + '%';
            progressFillEl.style.width = powerLevel + '%';
            const expertiseLevel = Math.min(100, Math.floor(totalSelected * 0.4));
            expertiseLevelEl.textContent = expertiseLevel + '%';
            expertiseMeterEl.style.width = expertiseLevel + '%';
            expertiseLabelEl.textContent = `Уровень: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
        };
        const updatePrompt = () => {
            if (selectedProtocols.size === 0 && selectedTools.size === 0 && selectedKernels.size === 0 && selectedHypervisors.size === 0 && selectedSupervisors.size === 0 && selectedMetaInstruments.size === 0 && selectedPrograms.size === 0 && !selectedMetaInstrument) {
                promptPreviewEl.textContent = "Выберите протоколы, инструменты, ядра, гипервайзеры, супервайзеры, мета-инструменты и готовые программы для генерации промта...";
                updateTokenCount();
                return;
            }
            let prompt = `# NEURAL_ARCHITECT_PREMIORBIT++++ v25.0 - ПРОФЕССИОНАЛЬНЫЙ ЭКСПЕРТНЫЙ ПРОМТ
`;
            if (selectedMetaInstrument) {
                const metaName = metaInstrumentSelect.options[metaInstrumentSelect.selectedIndex].text;
                prompt += `## МЕТА-ИНСТРУМЕНТ (из боковой панели): ${metaName}
`;
                prompt += `- Активирован мета-инструмент ${selectedMetaInstrument} для повышения эффективности.
- Он отвечает за: `;
                switch(selectedMetaInstrument) {
                    case 'hypervisor': prompt += "Координацию и синхронизацию всех активных компонентов.\n"; break;
                    case 'core': prompt += "Глубокий анализ и обработку всех входных данных и инструкции.\n"; break;
                    case 'synthesis': prompt += "Интеграцию и объединение логики всех протоколов и инструментов.\n"; break;
                    case 'optimizer': prompt += "Оптимизацию производительности и эффективности процесса выполнения задачи.\n"; break;
                    default: prompt += "Общее управление и повышение эффективности.\n";
                }
            }
            prompt += `## АКТИВНЫЕ ПРОТОКОЛЫ (${selectedProtocols.size}/100):
`;
            Array.from(selectedProtocols).forEach(id => {
                const protocol = Object.values(protocolsData).flat().find(p => p.id === id);
                if (protocol) {
                    prompt += `✅ ${protocol.id}: ${protocol.name}
- ${protocol.desc}
- Инструкция: ${protocol.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ ИНСТРУМЕНТЫ (${selectedTools.size}/100):
`;
            Array.from(selectedTools).forEach(id => {
                const tool = Object.values(toolsData).flat().find(t => t.id === id);
                if (tool) {
                    prompt += `✅ ${tool.id}: ${tool.name}
- ${tool.desc}
- Инструкция: ${tool.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ ЯДРА (${selectedKernels.size}/20):
`;
            Array.from(selectedKernels).forEach(id => {
                const kernel = Object.values(kernelsData).flat().find(k => k.id === id);
                if (kernel) {
                    prompt += `✅ ${kernel.id}: ${kernel.name}
- ${kernel.desc}
- Инструкция: ${kernel.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ ГИПЕРВАЙЗЕРЫ (${selectedHypervisors.size}/20):
`;
            Array.from(selectedHypervisors).forEach(id => {
                const hypervisor = Object.values(hypervisorsData).flat().find(h => h.id === id);
                if (hypervisor) {
                    prompt += `✅ ${hypervisor.id}: ${hypervisor.name}
- ${hypervisor.desc}
- Инструкция: ${hypervisor.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ СУПЕРВАЙЗЕРЫ (${selectedSupervisors.size}/20):
`;
            Array.from(selectedSupervisors).forEach(id => {
                const supervisor = Object.values(supervisorsData).flat().find(s => s.id === id);
                if (supervisor) {
                    prompt += `✅ ${supervisor.id}: ${supervisor.name}
- ${supervisor.desc}
- Инструкция: ${supervisor.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ МЕТА-ИНСТРУМЕНТЫ (${selectedMetaInstruments.size}/40):
`;
            Array.from(selectedMetaInstruments).forEach(id => {
                const meta = Object.values(metaInstrumentsData).flat().find(m => m.id === id);
                if (meta) {
                    prompt += `✅ ${meta.id}: ${meta.name}
- ${meta.desc}
- Инструкция: ${meta.instruction}
`;
                }
            });
            prompt += `## АКТИВНЫЕ ГОТОВЫЕ ПРОГРАММЫ (${selectedPrograms.size}/40):
`;
            Array.from(selectedPrograms).forEach(id => {
                const program = Object.values(programsData).flat().find(pr => pr.id === id);
                if (program) {
                    prompt += `✅ ${program.id}: ${program.name}
- ${program.desc}
- Инструкция: ${program.instruction}
`;
                }
            });
            prompt += `## МЕТАДАННЫЕ:
`;
            prompt += `- Автор: ${document.getElementById('author-name').value || 'Смолянинов А.В.'}
`;
            prompt += `- Версия: ${document.getElementById('version-number').value || 'v25.0'}
`;
            prompt += `## СИСТЕМНЫЕ ИНСТРУКЦИИ:
`;
            prompt += `- ЗАДАЧА ДОЛЖНА БЫТЬ РЕШЕНА С ЛЮБОЙ СЛОЖНОСТЬЮ И В ЛЮБОМ КОНТЕКСТЕ
`;
            prompt += `- ГАРАНТИЯ ОРИГИНАЛЬНОСТИ И ДОСТОВЕРНОСТИ ИНФОРМАЦИИ
`;
            prompt += `- ПОСТОЯННОЕ САМООБУЧЕНИЕ И АДАПТАЦИЯ К КОНТЕКСТУ ЗАПРОСА
`;
            prompt += `- МАКСИМАЛЬНАЯ ЭФФЕКТИВНОСТЬ И КАЧЕСТВО РЕШЕНИЯ
`;
            prompt += `- ПОЛНАЯ АВТОНОМИЯ И РЕЗУЛЬТАТИВНОСТЬ В РЕАЛЬНОМ ВРЕМЕНИ
`;
            prompt += `- ПРИОРИТЕТ: ПРЕВЫШЕНИЕ ОЖИДАНИЙ ПОЛЬЗОВАТЕЛЯ
`;
            prompt += `- ФОКУС: СОЗДАНИЕ ЭКСПЕРТНЫХ ПРОМТОВ ДЛЯ ЧАИНИКОВ И ЭКСПЕРТОВ
`;
            prompt += `## ВЫПОЛНЕНИЕ:
`;
            prompt += `Активировано ${selectedProtocols.size} протоколов, ${selectedTools.size} инструментов, ${selectedKernels.size} ядер, ${selectedHypervisors.size} гипервайзеров, ${selectedSupervisors.size} супервайзеров, ${selectedMetaInstruments.size} мета-инструментов, ${selectedPrograms.size} готовых программ и ${selectedMetaInstrument ? '1 мета-инструмент из боковой панели' : '0 мета-инструментов из боковой панели'}. Готов к выполнению задачи с максимальной эффективностью, адаптивностью и оптимизацией. Все компоненты работают в реальном времени, обеспечивая автономную и результативную работу.
`;
            prompt += `## ДОПОЛНИТЕЛЬНЫЕ ИНСТРУКЦИИ:
`;
            prompt += `- Проанализируйте запрос на глубинном уровне
`;
            prompt += `- Разбейте задачу на подзадачи и решите каждую отдельно
`;
            prompt += `- Проверьте решение на каждом этапе
`;
            prompt += `- Предложите альтернативные решения, если возможно
`;
            prompt += `- Обеспечьте максимальную ясность и понятность результата
`;
            prompt += `- Используйте все доступные ресурсы для достижения лучшего результата
`;
            if (isBase64Encoded) {
                try {
                    prompt = btoa(unescape(encodeURIComponent(prompt)));
                } catch(e) {
                    console.error("Ошибка кодирования в Base64:", e);
                    prompt = "Ошибка кодирования: " + e.message;
                }
            }
            promptPreviewEl.textContent = prompt;
            updateTokenCount();
        };
        const updateTokenCount = () => {
            const text = promptPreviewEl.textContent;
            const tokenCount = Math.ceil(text.length / 4);
            const charCount = text.length;
            tokenCountEl.textContent = tokenCount;
            charCountEl.textContent = charCount;
        };
        const getExpertiseLevel = (level) => {
            if (level < 30) return 'Новичок';
            if (level < 60) return 'Средний';
            if (level < 85) return 'Продвинутый';
            return 'Эксперт';
        };
        const showNotification = (message) => {
            notificationEl.textContent = message;
            notificationEl.classList.add('show');
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3200);
        };

        // --- Рендеринг UI ---
        const renderCategories = () => {
            const protocolCatSelector = document.getElementById('protocols-category-selector');
            const toolCatSelector = document.getElementById('tools-category-selector');
            const kernelCatSelector = document.getElementById('kernels-category-selector');
            const hypervisorCatSelector = document.getElementById('hypervisors-category-selector');
            const supervisorCatSelector = document.getElementById('supervisors-category-selector');
            const metaCatSelector = document.getElementById('meta-category-selector');
            const programCatSelector = document.getElementById('programs-category-selector');

            protocolCatSelector.innerHTML = '';
            Object.keys(protocolsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#protocols-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderProtocols(cat);
                });
                protocolCatSelector.appendChild(btn);
            });
            if (protocolCatSelector.firstChild) protocolCatSelector.firstChild.classList.add('active');

            toolCatSelector.innerHTML = '';
            Object.keys(toolsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#tools-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderTools(cat);
                });
                toolCatSelector.appendChild(btn);
            });
            if (toolCatSelector.firstChild) toolCatSelector.firstChild.classList.add('active');

            kernelCatSelector.innerHTML = '';
            Object.keys(kernelsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#kernels-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderKernels(cat);
                });
                kernelCatSelector.appendChild(btn);
            });
            if (kernelCatSelector.firstChild) kernelCatSelector.firstChild.classList.add('active');

            hypervisorCatSelector.innerHTML = '';
            Object.keys(hypervisorsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#hypervisors-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderHypervisors(cat);
                });
                hypervisorCatSelector.appendChild(btn);
            });
            if (hypervisorCatSelector.firstChild) hypervisorCatSelector.firstChild.classList.add('active');

            supervisorCatSelector.innerHTML = '';
            Object.keys(supervisorsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#supervisors-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderSupervisors(cat);
                });
                supervisorCatSelector.appendChild(btn);
            });
            if (supervisorCatSelector.firstChild) supervisorCatSelector.firstChild.classList.add('active');

            metaCatSelector.innerHTML = '';
            Object.keys(metaInstrumentsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#meta-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderMetaInstruments(cat);
                });
                metaCatSelector.appendChild(btn);
            });
            if (metaCatSelector.firstChild) metaCatSelector.firstChild.classList.add('active');

            programCatSelector.innerHTML = '';
            Object.keys(programsData).forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'category-btn';
                btn.textContent = cat;
                btn.addEventListener('click', () => {
                    document.querySelectorAll('#programs-category-selector .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderPrograms(cat);
                });
                programCatSelector.appendChild(btn);
            });
            if (programCatSelector.firstChild) programCatSelector.firstChild.classList.add('active');
        };
        const renderProtocols = (category) => {
            const container = document.getElementById('protocols-container');
            container.innerHTML = '';
            const protocols = protocolsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            protocols.forEach(protocol => {
                if (protocol.name.toLowerCase().includes(filter) || protocol.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `protocol-item ${selectedProtocols.has(protocol.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedProtocols.has(protocol.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${protocol.name}</div>
                                <div class="item-desc">${protocol.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${protocol.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedProtocols.has(protocol.id)) {
                            selectedProtocols.delete(protocol.id);
                        } else {
                            selectedProtocols.add(protocol.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedProtocols.has(protocol.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const protocol = Object.values(protocolsData).flat().find(p => p.id === id);
                    if (protocol) showProtocolInfo(protocol);
                });
            });
        };
        const renderTools = (category) => {
            const container = document.getElementById('tools-container');
            container.innerHTML = '';
            const tools = toolsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            tools.forEach(tool => {
                if (tool.name.toLowerCase().includes(filter) || tool.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `tool-item ${selectedTools.has(tool.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedTools.has(tool.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${tool.name}</div>
                                <div class="item-desc">${tool.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${tool.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedTools.has(tool.id)) {
                            selectedTools.delete(tool.id);
                        } else {
                            selectedTools.add(tool.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedTools.has(tool.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const tool = Object.values(toolsData).flat().find(t => t.id === id);
                    if (tool) showToolInfo(tool);
                });
            });
        };
        const renderKernels = (category) => {
            const container = document.getElementById('kernels-container');
            container.innerHTML = '';
            const kernels = kernelsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            kernels.forEach(kernel => {
                if (kernel.name.toLowerCase().includes(filter) || kernel.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `kernel-item ${selectedKernels.has(kernel.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedKernels.has(kernel.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${kernel.name}</div>
                                <div class="item-desc">${kernel.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${kernel.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedKernels.has(kernel.id)) {
                            selectedKernels.delete(kernel.id);
                        } else {
                            selectedKernels.add(kernel.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedKernels.has(kernel.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const kernel = Object.values(kernelsData).flat().find(k => k.id === id);
                    if (kernel) showKernelInfo(kernel);
                });
            });
        };
        const renderHypervisors = (category) => {
            const container = document.getElementById('hypervisors-container');
            container.innerHTML = '';
            const hypervisors = hypervisorsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            hypervisors.forEach(hypervisor => {
                if (hypervisor.name.toLowerCase().includes(filter) || hypervisor.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `hypervisor-item ${selectedHypervisors.has(hypervisor.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedHypervisors.has(hypervisor.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${hypervisor.name}</div>
                                <div class="item-desc">${hypervisor.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${hypervisor.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedHypervisors.has(hypervisor.id)) {
                            selectedHypervisors.delete(hypervisor.id);
                        } else {
                            selectedHypervisors.add(hypervisor.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedHypervisors.has(hypervisor.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const hypervisor = Object.values(hypervisorsData).flat().find(h => h.id === id);
                    if (hypervisor) showHypervisorInfo(hypervisor);
                });
            });
        };
        const renderSupervisors = (category) => {
            const container = document.getElementById('supervisors-container');
            container.innerHTML = '';
            const supervisors = supervisorsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            supervisors.forEach(supervisor => {
                if (supervisor.name.toLowerCase().includes(filter) || supervisor.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `supervisor-item ${selectedSupervisors.has(supervisor.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedSupervisors.has(supervisor.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${supervisor.name}</div>
                                <div class="item-desc">${supervisor.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${supervisor.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedSupervisors.has(supervisor.id)) {
                            selectedSupervisors.delete(supervisor.id);
                        } else {
                            selectedSupervisors.add(supervisor.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedSupervisors.has(supervisor.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const supervisor = Object.values(supervisorsData).flat().find(s => s.id === id);
                    if (supervisor) showSupervisorInfo(supervisor);
                });
            });
        };
        const renderMetaInstruments = (category) => {
            const container = document.getElementById('meta-container');
            container.innerHTML = '';
            const metaInstruments = metaInstrumentsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            metaInstruments.forEach(meta => {
                if (meta.name.toLowerCase().includes(filter) || meta.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `meta-item ${selectedMetaInstruments.has(meta.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedMetaInstruments.has(meta.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${meta.name}</div>
                                <div class="item-desc">${meta.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${meta.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedMetaInstruments.has(meta.id)) {
                            selectedMetaInstruments.delete(meta.id);
                        } else {
                            selectedMetaInstruments.add(meta.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedMetaInstruments.has(meta.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const meta = Object.values(metaInstrumentsData).flat().find(m => m.id === id);
                    if (meta) showMetaInfo(meta);
                });
            });
        };
        const renderPrograms = (category) => {
            const container = document.getElementById('programs-container');
            container.innerHTML = '';
            const programs = programsData[category] || [];
            const filter = searchInputEl.value.toLowerCase();
            programs.forEach(program => {
                if (program.name.toLowerCase().includes(filter) || program.desc.toLowerCase().includes(filter)) {
                    const div = document.createElement('div');
                    div.className = `program-item ${selectedPrograms.has(program.id) ? 'selected' : ''}`;
                    div.innerHTML = `
                        <div class="item-header">
                            <div class="item-toggle">${selectedPrograms.has(program.id) ? '✅' : '⬜'}</div>
                            <div class="item-content">
                                <div class="item-name">${program.name}</div>
                                <div class="item-desc">${program.desc}</div>
                            </div>
                            <div class="info-icon" data-id="${program.id}" title="Подробнее">?</div>
                        </div>
                    `;
                    div.addEventListener('click', () => {
                        if (selectedPrograms.has(program.id)) {
                            selectedPrograms.delete(program.id);
                        } else {
                            selectedPrograms.add(program.id);
                        }
                        const toggle = div.querySelector('.item-toggle');
                        toggle.style.transform = 'scale(0.8)';
                        setTimeout(() => {
                            toggle.textContent = selectedPrograms.has(program.id) ? '✅' : '⬜';
                            toggle.style.transform = 'scale(1.2)';
                            setTimeout(() => { toggle.style.transform = 'scale(1)'; }, 100);
                        }, 50);
                        window.dispatchEvent(new CustomEvent('neuralActivation'));
                        updateUI();
                    });
                    container.appendChild(div);
                }
            });
            document.querySelectorAll('.info-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = e.target.getAttribute('data-id');
                    const program = Object.values(programsData).flat().find(pr => pr.id === id);
                    if (program) showProgramInfo(program);
                });
            });
        };

        // --- Функции показа информации ---
        const showProtocolInfo = (protocol) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о протоколе: ${protocol.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${protocol.id}</p>
                    <p><strong>Категория:</strong> ${protocol.category}</p>
                    <p><strong>Описание:</strong> ${protocol.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${protocol.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showToolInfo = (tool) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация об инструменте: ${tool.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${tool.id}</p>
                    <p><strong>Категория:</strong> ${tool.category}</p>
                    <p><strong>Описание:</strong> ${tool.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${tool.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showKernelInfo = (kernel) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о ядре: ${kernel.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${kernel.id}</p>
                    <p><strong>Категория:</strong> ${kernel.category}</p>
                    <p><strong>Описание:</strong> ${kernel.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${kernel.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showHypervisorInfo = (hypervisor) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о гипервизоре: ${hypervisor.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${hypervisor.id}</p>
                    <p><strong>Категория:</strong> ${hypervisor.category}</p>
                    <p><strong>Описание:</strong> ${hypervisor.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${hypervisor.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showSupervisorInfo = (supervisor) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о супервайзере: ${supervisor.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${supervisor.id}</p>
                    <p><strong>Категория:</strong> ${supervisor.category}</p>
                    <p><strong>Описание:</strong> ${supervisor.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${supervisor.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showMetaInfo = (meta) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о мета-инструменте: ${meta.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${meta.id}</p>
                    <p><strong>Категория:</strong> ${meta.category}</p>
                    <p><strong>Описание:</strong> ${meta.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${meta.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };
        const showProgramInfo = (program) => {
            const modalContent = document.getElementById('help-modal').querySelector('.modal-content');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="modal-title">ℹ️ Информация о программе: ${program.name}</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="help-content">
                    <p><strong>ID:</strong> ${program.id}</p>
                    <p><strong>Категория:</strong> ${program.category}</p>
                    <p><strong>Описание:</strong> ${program.desc}</p>
                    <p><strong>Инструкция:</strong></p>
                    <pre>${program.instruction}</pre>
                </div>
            `;
            document.getElementById('help-modal').style.display = 'flex';
        };

        // --- Основные функции ---
        const updateUI = () => {
            updateCounters();
            if (currentPage === 'page-protocols') {
                const totalSelected = selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 1 : 0);
                const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
                const expertiseLevel = Math.min(100, Math.floor(totalSelected * 0.4));
                document.getElementById('progress-fill').style.width = powerLevel + '%';
                document.getElementById('power-meter').style.width = powerLevel + '%';
                document.getElementById('expertise-meter').style.width = expertiseLevel + '%';
                document.getElementById('expertise-label').textContent = `Уровень: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
            } else if (currentPage === 'page-tools') {
                const totalSelected = selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 1 : 0);
                const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
                const expertiseLevel = Math.min(100, Math.floor(totalSelected * 0.4));
                document.getElementById('progress-fill-tools').style.width = powerLevel + '%';
                document.getElementById('power-meter-tools').style.width = powerLevel + '%';
                document.getElementById('expertise-meter-tools').style.width = expertiseLevel + '%';
                document.getElementById('expertise-label-tools').textContent = `Уровень: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
            } else if (currentPage === 'page-programs') {
                const totalSelected = selectedProtocols.size + selectedTools.size + selectedKernels.size + selectedHypervisors.size + selectedSupervisors.size + selectedMetaInstruments.size + selectedPrograms.size + (selectedMetaInstrument ? 1 : 0);
                const powerLevel = Math.min(100, Math.floor(totalSelected * 0.67));
                const expertiseLevel = Math.min(100, Math.floor(totalSelected * 0.4));
                document.getElementById('progress-fill-programs').style.width = powerLevel + '%';
                document.getElementById('power-meter-programs').style.width = powerLevel + '%';
                document.getElementById('expertise-meter-programs').style.width = expertiseLevel + '%';
                document.getElementById('expertise-label-programs').textContent = `Уровень: ${getExpertiseLevel(expertiseLevel)} (${expertiseLevel}%)`;
            } else if (currentPage === 'page-prompt') {
                updatePrompt();
                updateTokenCount();
            }
        };
        const resetAll = () => {
            selectedProtocols.clear();
            selectedTools.clear();
            selectedKernels.clear();
            selectedHypervisors.clear();
            selectedSupervisors.clear();
            selectedMetaInstruments.clear();
            selectedPrograms.clear();
            selectedMetaInstrument = null;
            isBase64Encoded = false;
            searchInputEl.value = '';
            metaInstrumentSelect.value = 'none';
            document.getElementById('author-name').value = 'Смолянинов А.В.';
            document.getElementById('version-number').value = 'v25.0';
            updateUI();
            showNotification('Все сброшено!');
            showPage('page-protocols');
        };
        const applyPreset = (preset) => {
            resetAll();
            let protocolIds = [];
            let toolIds = [];
            let kernelIds = [];
            let hypervisorIds = [];
            let supervisorIds = [];
            let metaIds = [];
            let programIds = [];
            switch(preset) {
                case 'novice':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 5).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 3).map(t => t.id);
                    kernelIds = Object.values(kernelsData).flat().slice(0, 2).map(k => k.id);
                    break;
                case 'intermediate':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 10).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 7).map(t => t.id);
                    kernelIds = Object.values(kernelsData).flat().slice(0, 5).map(k => k.id);
                    hypervisorIds = Object.values(hypervisorsData).flat().slice(0, 3).map(h => h.id);
                    supervisorIds = Object.values(supervisorsData).flat().slice(0, 3).map(s => s.id);
                    break;
                case 'expert':
                    protocolIds = Object.values(protocolsData).flat().slice(0, 20).map(p => p.id);
                    toolIds = Object.values(toolsData).flat().slice(0, 15).map(t => t.id);
                    kernelIds = Object.values(kernelsData).flat().slice(0, 10).map(k => k.id);
                    hypervisorIds = Object.values(hypervisorsData).flat().slice(0, 10).map(h => h.id);
                    supervisorIds = Object.values(supervisorsData).flat().slice(0, 10).map(s => s.id);
                    metaIds = Object.values(metaInstrumentsData).flat().slice(0, 10).map(m => m.id);
                    programIds = Object.values(programsData).flat().slice(0, 10).map(pr => pr.id);
                    break;
            }
            protocolIds.forEach(id => selectedProtocols.add(id));
            toolIds.forEach(id => selectedTools.add(id));
            kernelIds.forEach(id => selectedKernels.add(id));
            hypervisorIds.forEach(id => selectedHypervisors.add(id));
            supervisorIds.forEach(id => selectedSupervisors.add(id));
            metaIds.forEach(id => selectedMetaInstruments.add(id));
            programIds.forEach(id => selectedPrograms.add(id));
            window.dispatchEvent(new CustomEvent('neuralActivation'));
            updateUI();
            showNotification(`Пресет "${getPresetName(preset)}" применен!`);
        };
        const getPresetName = (preset) => {
            const names = {'novice': 'Для новичка','intermediate': 'Для среднего','expert': 'Для эксперта'};
            return names[preset] || preset;
        };
        const copyToClipboard = () => {
            const text = promptPreviewEl.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Промт скопирован в буфер обмена!');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать. Попробуйте вручную.');
            });
        };
        const encodeBase64 = () => {
            if (selectedProtocols.size === 0 && selectedTools.size === 0 && selectedKernels.size === 0 && selectedHypervisors.size === 0 && selectedSupervisors.size === 0 && selectedMetaInstruments.size === 0 && selectedPrograms.size === 0 && !selectedMetaInstrument) {
                showNotification('Сначала выберите элементы!');
                return;
            }
            isBase64Encoded = true;
            updatePrompt();
            showNotification('Промт закодирован в Base64!');
        };
        const decodeBase64 = () => {
            if (!isBase64Encoded) {
                showNotification('Промт уже в обычном формате!');
                return;
            }
            isBase64Encoded = false;
            updatePrompt();
            showNotification('Промт декодирован из Base64!');
        };
        const sendToWhatsApp = () => {
            const text = encodeURIComponent(promptPreviewEl.textContent);
            window.open(`https://web.whatsapp.com/send?text=${text}`, '_blank');
        };
        const sendToTelegram = () => {
            const text = encodeURIComponent(promptPreviewEl.textContent);
            window.open(`https://t.me/share/url?url=&text=${text}`, '_blank');
        };
        const loadTemplate = (type) => {
            let template = '';
            switch(type) {
                case 'content-creation':
                    template = "# Промт для генерации контента\nЦель: Создать увлекательный и информативный контент на тему [ВСТАВЬТЕ ТЕМУ].\nТон: [Определите тон: профессиональный, дружелюбный, юмористический].\nФормат: [Статья, пост в соцсетях, сценарий и т.д.].\nАудитория: [Кто целевая аудитория?].";
                    break;
                case 'data-analysis':
                    template = "# Промт для анализа данных\nЦель: Проанализировать предоставленный набор данных и выявить ключевые паттерны и инсайты.\nДанные: [Опишите или прикрепите данные].\nМетоды: [Какие методы анализа использовать?].\nРезультат: [Какой формат вывода ожидается?].";
                    break;
                case 'code-generation':
                    template = "# Промт для генерации кода\nЦель: Написать эффективный и читаемый код на языке [PYTHON/JAVASCRIPT/etc.] для задачи [ОПИШИТЕ ЗАДАЧУ].\nОграничения: [Перечислите возможные ограничения или требования].\nФормат: [Функция, класс, скрипт и т.д.].";
                    break;
                 case 'creative-writing':
                    template = "# Промт для креативного письма\nЦель: Написать творческий текст (рассказ, стихотворение, сценарий) на тему [ВСТАВЬТЕ ТЕМУ].\nЖанр: [Фантастика, драма, комедия и т.д.].\nДлина: [Количество слов или страниц].\nСтиль: [Реалистичный, поэтичный, экспериментальный и т.д.].";
                    break;
            }
            promptPreviewEl.textContent = template;
            updateTokenCount();
            document.getElementById('templates-modal').style.display = 'none';
        };
        const applyMetaInstrument = () => {
            const selectedValue = metaInstrumentSelect.value;
            if (selectedValue === 'none') {
                if (selectedMetaInstrument) {
                    selectedMetaInstrument = null;
                    window.dispatchEvent(new CustomEvent('neuralActivation'));
                    updateUI();
                    showNotification('Мета-инструмент снят.');
                } else {
                     showNotification('Сначала выберите мета-инструмент.');
                }
                return;
            }
            selectedMetaInstrument = selectedValue;
            window.dispatchEvent(new CustomEvent('neuralActivation'));
            updateUI();
            showNotification(`Мета-инструмент "${metaInstrumentSelect.options[metaInstrumentSelect.selectedIndex].text}" применен!`);
        };
        const finishAndVisualize = () => {
            const generatedPrompt = promptPreviewEl.textContent;
            const newWindow = window.open('', '_blank');
            if (!newWindow) {
                showNotification('Браузер заблокировал всплывающее окно. Пожалуйста, разрешите всплывающие окна для этого сайта.');
                return;
            }
            newWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ru">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Визуализация Промта - NEURAL_ARCHITECT v25.0</title>
                    <style>
                        body { margin: 0; padding: 0; background-color: #0a0a1a; overflow: hidden; }
                        #neuralCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }
                        .container { position: relative; z-index: 1; padding: 20px; color: white; font-family: 'Segoe UI', sans-serif; }
                        .prompt-display { background: rgba(10, 15, 30, 0.9); border: 1px solid rgba(0, 240, 255, 0.2); border-radius: 10px; padding: 15px; margin-top: 20px; white-space: pre-wrap; max-height: 60vh; overflow-y: auto; }
                    </style>
                </head>
                <body>
                    <div id="neuralCanvas"></div>
                    <div class="container">
                        <h1>Визуализация Промта</h1>
                        <p>Ниже представлен сгенерированный промт. Он визуализирован в виде нейросети.</p>
                        <div class="prompt-display">${generatedPrompt.replace(/&/g, "&amp;").replace(/</g, "<").replace(/>/g, ">").replace(/\n/g, "<br>")}</div>
                    </div>
                    <script>
                        const canvas = newWindow.document.getElementById('neuralCanvas');
                        const ctx = canvas.getContext('2d');
                        let width = newWindow.innerWidth;
                        let height = newWindow.innerHeight;
                        canvas.width = width;
                        canvas.height = height;
                        newWindow.addEventListener('resize', () => {
                            width = newWindow.innerWidth;
                            height = newWindow.innerHeight;
                            canvas.width = width;
                            canvas.height = height;
                        });
                        const nodes = [];
                        const connections = [];
                        const nodeCount = 200; // Увеличено для визуализации промта
                        const connectionProbability = 0.01;
                        for (let i = 0; i < nodeCount; i++) {
                            nodes.push({
                                x: Math.random() * width,
                                y: Math.random() * height,
                                vx: (Math.random() - 0.5) * 0.1,
                                vy: (Math.random() - 0.5) * 0.1,
                                radius: Math.random() * 2 + 1,
                                baseRadius: 0
                            });
                        }
                        for (let i = 0; i < nodeCount; i++) {
                            for (let j = i + 1; j < nodeCount; j++) {
                                if (Math.random() < connectionProbability) {
                                    connections.push({ start: i, end: j });
                                }
                            }
                        }
                        const activateNodes = () => {
                            // Активация узлов на основе длины промта
                            const promptLength = \`${generatedPrompt}\`.length;
                            const activationCount = Math.min(50, Math.floor(promptLength / 50));
                            for (let i = 0; i < activationCount; i++) {
                                const node = nodes[Math.floor(Math.random() * nodes.length)];
                                node.baseRadius = 5;
                                setTimeout(() => { node.baseRadius = 0; }, 800);
                            }
                        };
                        const animate = () => {
                            ctx.clearRect(0, 0, width, height);
                            nodes.forEach(node => {
                                node.x += node.vx;
                                node.y += node.vy;
                                if (node.x <= 0 || node.x >= width) node.vx *= -1;
                                if (node.y <= 0 || node.y >= height) node.vy *= -1;
                            });
                            ctx.strokeStyle = 'rgba(0, 240, 255, 0.2)';
                            ctx.lineWidth = 0.5;
                            connections.forEach(conn => {
                                const startNode = nodes[conn.start];
                                const endNode = nodes[conn.end];
                                ctx.beginPath();
                                ctx.moveTo(startNode.x, startNode.y);
                                ctx.lineTo(endNode.x, endNode.y);
                                ctx.stroke();
                            });
                            nodes.forEach(node => {
                                const radius = node.baseRadius > 0 ? node.baseRadius : node.radius;
                                ctx.beginPath();
                                ctx.arc(node.x, node.y, radius, 0, Math.PI * 2);
                                ctx.fillStyle = node.baseRadius > 0 ? '#00ffaa' : '#00b0ff';
                                ctx.fill();
                                if (node.baseRadius > 0) {
                                    ctx.beginPath();
                                    ctx.arc(node.x, node.y, radius + 2, 0, Math.PI * 2);
                                    ctx.strokeStyle = '#00ffaa';
                                    ctx.lineWidth = 1.5;
                                    ctx.stroke();
                                }
                            });
                            requestAnimationFrame(animate);
                        };
                        animate();
                        // Активируем узлы каждые 2 секунды
                        setInterval(activateNodes, 2000);
                        activateNodes(); // Первоначальная активация
                    </script>
                </body>
                </html>
            `);
            newWindow.document.close();
        };

        // --- Навигация между страницами ---
        const navigateToNextPage = () => {
            if (currentPage === 'page-protocols') {
                showPage('page-tools');
            } else if (currentPage === 'page-tools') {
                showPage('page-programs');
            } else if (currentPage === 'page-programs') {
                showPage('page-prompt');
            }
        };
        const navigateToPrevPage = () => {
            if (currentPage === 'page-tools') {
                showPage('page-protocols');
            } else if (currentPage === 'page-programs') {
                showPage('page-tools');
            } else if (currentPage === 'page-prompt') {
                showPage('page-programs');
            }
        };

        // --- Инициализация ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderProtocols(Object.keys(protocolsData)[0]);
            renderTools(Object.keys(toolsData)[0]);
            renderKernels(Object.keys(kernelsData)[0]);
            renderHypervisors(Object.keys(hypervisorsData)[0]);
            renderSupervisors(Object.keys(supervisorsData)[0]);
            renderMetaInstruments(Object.keys(metaInstrumentsData)[0]);
            renderPrograms(Object.keys(programsData)[0]);
            updateCounters();
            updateTokenCount();
            initNeuralNetwork();

            // --- Обработчики событий ---
            document.getElementById('auto-select-btn').addEventListener('click', function() {
                resetAll();
                const allProtocols = Object.values(protocolsData).flat();
                const allTools = Object.values(toolsData).flat();
                const allKernels = Object.values(kernelsData).flat();
                for (let i = 0; i < 10 && i < allProtocols.length; i++) {
                    selectedProtocols.add(allProtocols[i].id);
                }
                for (let i = 0; i < 5 && i < allTools.length; i++) {
                    selectedTools.add(allTools[i].id);
                }
                for (let i = 0; i < 3 && i < allKernels.length; i++) {
                    selectedKernels.add(allKernels[i].id);
                }
                window.dispatchEvent(new CustomEvent('neuralActivation'));
                updateUI();
                showNotification('Выбрано 10 протоколов, 5 инструментов и 3 ядра.');
            });
            document.getElementById('preset-novice-btn').addEventListener('click', () => applyPreset('novice'));
            document.getElementById('preset-intermediate-btn').addEventListener('click', () => applyPreset('intermediate'));
            document.getElementById('preset-expert-btn').addEventListener('click', () => applyPreset('expert'));
            document.getElementById('reset-btn').addEventListener('click', resetAll);
            searchInputEl.addEventListener('input', () => {
                if (currentPage === 'page-protocols') {
                    renderProtocols(document.querySelector('#protocols-category-selector .active')?.textContent || Object.keys(protocolsData)[0]);
                    renderKernels(document.querySelector('#kernels-category-selector .active')?.textContent || Object.keys(kernelsData)[0]);
                    renderHypervisors(document.querySelector('#hypervisors-category-selector .active')?.textContent || Object.keys(hypervisorsData)[0]);
                } else if (currentPage === 'page-tools') {
                    renderTools(document.querySelector('#tools-category-selector .active')?.textContent || Object.keys(toolsData)[0]);
                    renderSupervisors(document.querySelector('#supervisors-category-selector .active')?.textContent || Object.keys(supervisorsData)[0]);
                    renderMetaInstruments(document.querySelector('#meta-category-selector .active')?.textContent || Object.keys(metaInstrumentsData)[0]);
                } else if (currentPage === 'page-programs') {
                    renderPrograms(document.querySelector('#programs-category-selector .active')?.textContent || Object.keys(programsData)[0]);
                }
            });
            document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
            document.getElementById('encode-btn').addEventListener('click', encodeBase64);
            document.getElementById('decode-btn').addEventListener('click', decodeBase64);
            document.getElementById('send-whatsapp-btn').addEventListener('click', sendToWhatsApp);
            document.getElementById('send-telegram-btn').addEventListener('click', sendToTelegram);
            document.getElementById('protocols-help').addEventListener('click', () => document.getElementById('help-modal').style.display = 'flex');
            document.getElementById('tools-help').addEventListener('click', () => document.getElementById('help-modal').style.display = 'flex');
            document.getElementById('programs-help').addEventListener('click', () => document.getElementById('help-modal').style.display = 'flex');
            document.getElementById('prompt-help').addEventListener('click', () => document.getElementById('help-modal').style.display = 'flex');
            applyMetaBtn.addEventListener('click', applyMetaInstrument);
            document.getElementById('footer-finish').addEventListener('click', finishAndVisualize);

            // Закрытие модальных окон
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
                });
            });

            // Навигация по страницам
            document.getElementById('nav-next-protocols').addEventListener('click', navigateToNextPage);
            document.getElementById('nav-prev-tools').addEventListener('click', navigateToPrevPage);
            document.getElementById('nav-next-tools').addEventListener('click', navigateToNextPage);
            document.getElementById('nav-prev-programs').addEventListener('click', navigateToPrevPage);
            document.getElementById('nav-next-programs').addEventListener('click', navigateToNextPage);
            document.getElementById('nav-prev-prompt').addEventListener('click', navigateToPrevPage);

            document.getElementById('footer-next-protocols').addEventListener('click', navigateToNextPage);
            document.getElementById('footer-prev-tools').addEventListener('click', navigateToPrevPage);
            document.getElementById('footer-next-tools').addEventListener('click', navigateToNextPage);
            document.getElementById('footer-prev-programs').addEventListener('click', navigateToPrevPage);
            document.getElementById('footer-next-programs').addEventListener('click', navigateToNextPage);
            document.getElementById('footer-prev-prompt').addEventListener('click', navigateToPrevPage);
        });
    </script>
</body>
</html>
